<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Setters Cheat Sheet</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap');

        :root {
            /* ========== NEW ZEALAND FRESH GREEN FUTURISM ========== */
            /* Spring Water × Mountain Peaks × Deep Forest - Level 99 */

            /* FRESH NEUTRAL BASE - Crisp & Clean */
            --color-cream-50: #f8fafb;
            --color-cream-100: #f0f4f8;
            --color-warm-100: #e8f0f2;
            --color-warm-200: #d4e4e8;
            --color-warm-300: #b8cfd6;
            --color-taupe-900: #0f2e3d;

            /* Primary: Alpine Teal (Mountain Lakes) - Fresh & Deep */
            --primary-50: #f0fdf9;
            --primary-100: #d0faf0;
            --primary-200: #99f6e4;
            --primary-300: #5eead4;
            --primary-400: #2dd4bf;
            --primary-500: #0d9488;
            --primary-600: #0f766e;
            --primary-700: #115e59;
            --primary-800: #134e4a;
            --primary-900: #0f3b3a;

            /* Secondary: Forest Green (Deep Woods) - Rich & Grounding */
            --teal-50: #f0fdf4;
            --teal-100: #dcfce7;
            --teal-500: #16a34a;
            --teal-600: #15803d;
            --teal-700: #14532d;

            /* Accent: Mint (Fresh Air) - Light & Energizing */
            --purple-50: #f0fdfa;
            --purple-100: #ccfbf1;
            --purple-500: #14b8a6;
            --purple-600: #0d9488;
            --purple-700: #0f766e;

            /* Accent: Seafoam (Spring Water) - Clean & Vibrant */
            --emerald-50: #ecfeff;
            --emerald-100: #cffafe;
            --emerald-500: #06b6d4;
            --emerald-600: #0891b2;
            --emerald-700: #0e7490;

            /* Accent: Slate Blue (Mountain Stone) - Sophisticated & Cool */
            --amber-50: #f8fafc;
            --amber-100: #e2e8f0;
            --amber-500: #64748b;
            --amber-600: #475569;
            --amber-700: #334155;

            /* Backgrounds - Fresh & Crisp */
            --bg-primary: #f8fafb;
            --bg-secondary: #f0f4f8;
            --bg-tertiary: #e8f0f2;
            --surface: #ffffff;
            --surface-hover: #fdfbf7;
            --surface-elevated: #ffffff;
            --appbar: rgba(253, 251, 247, 0.95);

            /* Backgrounds - Dark Mode */
            --dark-bg-primary: #0d1117;
            --dark-bg-secondary: #161b22;
            --dark-bg-tertiary: #21262d;
            --dark-surface: #1c2128;
            --dark-surface-hover: #2d333b;
            --dark-appbar: rgba(22, 27, 34, 0.95);

            /* Text Hierarchy - Cool mountain tones */
            --text-primary: #0f2e3d;         /* headings, important text */
            --text-secondary: #475569;       /* body text */
            --text-tertiary: #64748b;        /* muted text */
            --text-disabled: #cbd5e1;        /* disabled state */
            --text-inverse: #f8fafb;         /* text on dark backgrounds */

            /* Dark mode text */
            --dark-text-primary: #f0f6fc;
            --dark-text-secondary: #9ea7b3;
            --dark-text-tertiary: #636e7b;

            /* Borders & Dividers - Fresh alpine lines */
            --border-light: #d4e4e8;
            --border-medium: #b8cfd6;
            --border-strong: #94a3b8;
            --border-interactive: #cbd5e1;
            --divider: rgba(15, 46, 61, 0.06);

            /* Dark mode borders */
            --dark-border-light: #30363d;
            --dark-border-medium: #3e4750;

            /* Brand Colors - Cherokee Red (Terracotta) */
            --primary-200: #e5cec5;
            --primary-300: #d4b5a6;
            --primary-400: #c58d77;
            --primary-800: #6d3a2d;
            --primary-900: #5a2f25;

            /* Accent Colors - Bronze/Copper */
            --accent-50: #f7f5f3;
            --accent-100: #ebe5dd;
            --accent-200: #d9ccb8;
            --accent-300: #c4af93;
            --accent-400: #a38962;
            --accent-500: #8b6f47;            /* main accent */
            --accent-600: #75603d;
            --accent-700: #5e4d31;
            --accent-800: #4a3d27;

            /* Success (Forest Green) */
            --success-50: #f0fdf4;
            --success-100: #dcfce7;
            --success-500: #16a34a;
            --success-600: #15803d;
            --success-700: #14532d;

            /* Warning (Mountain Gold) */
            --warning-50: #fefce8;
            --warning-100: #fef9c3;
            --warning-500: #eab308;
            --warning-600: #ca8a04;
            --warning-700: #a16207;

            /* Danger (Deep Slate) */
            --danger-50: #fef2f2;
            --danger-100: #fee2e2;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --danger-700: #b91c1c;

            /* Info (Seafoam) */
            --info-50: #ecfeff;
            --info-500: #06b6d4;
            --info-600: #0891b2;

            /* Gradients - Fresh alpine flows */
            --gradient-primary: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
            --gradient-success: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-premium: linear-gradient(135deg, #14b8a6 0%, #0d9488 50%, #06b6d4 100%);
            --gradient-glass: linear-gradient(135deg, rgba(248,250,251,0.1) 0%, rgba(248,250,251,0.05) 100%);

            /* Elevation System (5 levels) */
            --elevation-0: none;
            --elevation-1: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --elevation-2: 0 2px 8px 0 rgba(0, 0, 0, 0.08), 0 1px 4px 0 rgba(0, 0, 0, 0.04);
            --elevation-3: 0 8px 16px 0 rgba(0, 0, 0, 0.12), 0 2px 8px 0 rgba(0, 0, 0, 0.06);
            --elevation-4: 0 16px 32px 0 rgba(0, 0, 0, 0.16), 0 4px 16px 0 rgba(0, 0, 0, 0.08);
            --elevation-5: 0 24px 48px 0 rgba(0, 0, 0, 0.20), 0 8px 24px 0 rgba(0, 0, 0, 0.10);

            /* Hover shadows */
            --shadow-hover-sm: 0 4px 12px 0 rgba(0, 0, 0, 0.10);
            --shadow-hover-md: 0 12px 24px 0 rgba(0, 0, 0, 0.14);
            --shadow-hover-lg: 0 20px 40px 0 rgba(0, 0, 0, 0.18);

            /* Focus & Interactive - Fresh glows */
            --focus-ring: 0 0 0 3px rgba(13, 148, 136, 0.3);
            --focus-ring-danger: 0 0 0 3px rgba(239, 68, 68, 0.5);

            /* Border Radius System */
            --radius-xs: 4px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-full: 9999px;

            /* GOLDEN RATIO SPACING (φ = 1.618) - Wright-inspired Harmony */
            --space-0: 0;
            --space-1: 4px;
            --space-2: 8px;
            --space-phi-1: 16px;      /* base unit */
            --space-phi-2: 26px;      /* 16 × 1.618 */
            --space-phi-3: 42px;      /* 26 × 1.618 */
            --space-phi-4: 68px;      /* 42 × 1.618 */
            --space-phi-5: 110px;     /* 68 × 1.618 */

            /* Legacy support */
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;

            /* PERFECT FOURTH TYPOGRAPHY SCALE (1.333 ratio) */
            --text-xs: 12px;         /* captions, labels */
            --text-sm: 14px;         /* small text */
            --text-base: 16px;       /* body text */
            --text-lg: 19px;         /* 16 × 1.2 */
            --text-xl: 24px;         /* 19 × 1.25 */
            --text-2xl: 28px;        /* headings */
            --text-3xl: 36px;        /* large headings */

            /* Typography Weights */
            --font-light: 300;
            --font-normal: 400;
            --font-medium: 500;
            --font-semibold: 600;
            --font-bold: 700;
            --font-extrabold: 800;
            --font-black: 900;

            /* Z-index layers */
            --z-base: 0;
            --z-dropdown: 100;
            --z-sticky: 200;
            --z-fixed: 300;
            --z-modal-backdrop: 400;
            --z-modal: 500;
            --z-popover: 600;
            --z-tooltip: 700;

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 500ms cubic-bezier(0.68, -0.55, 0.265, 1.55);

            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-blur: blur(12px);

            /* ========== ENHANCED CARD UI - SEMANTIC ZONE TOKENS ========== */
            /* Notes Zone - Teal */
            --surface-note: #f0fdfa;
            --ink-note: #115e59;
            --border-note: #5eead4;

            /* Campaign Zone - Violet */
            --surface-campaign: #f5f3ff;
            --ink-campaign: #6d28d9;
            --border-campaign: #a78bfa;

            /* Industries Zone - Lime */
            --surface-industries: #f7fee7;
            --ink-industries: #3f6212;
            --border-industries: #bef264;

            /* Target States Zone - Blue */
            --surface-target: #eff6ff;
            --ink-target: #1e40af;
            --border-target: #93c5fd;

            /* ========== COMPATIBILITY ALIASES (for old code) ========== */
            --bg: var(--bg-primary);
            --panel: var(--surface);
            --text: var(--text-primary);
            --text-dim: var(--text-secondary);
            --muted-text: var(--text-tertiary);
            --border: var(--border-light);
            --border-strong: var(--border-medium);
            --primary: var(--primary-500);
            --primary-2: var(--primary-600);
            --accent: var(--accent-500);
            --accent-2: var(--accent-600);
            --success: var(--success-500);
            --warning: var(--warning-500);
            --danger: var(--danger-500);
            --radius: var(--radius-lg);
            --shadow-sm: var(--elevation-1);
            --shadow-md: var(--elevation-2);
            --shadow-hover: var(--elevation-3);
            --focus: var(--focus-ring);
            --pill-bg: var(--surface);
            --pill-hover: var(--surface-hover);
            --gradient-start: #667eea;
            --gradient-end: #764ba2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            background: var(--bg-primary);
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(15, 46, 61, 0.015) 2px, rgba(15, 46, 61, 0.015) 4px);
            color: var(--text-secondary);
            font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            font-size: 15px;
            line-height: 1.6;
            font-weight: var(--font-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary);
            letter-spacing: -0.02em;
            font-weight: var(--font-semibold);
            line-height: 1.3;
        }

        h1 {
            font-size: 32px;
            font-weight: var(--font-bold);
        }

        h2 {
            font-size: 24px;
            font-weight: var(--font-semibold);
        }

        h3 {
            font-size: 20px;
        }

        h4 {
            font-size: 18px;
        }

        .brand {
            font-weight: var(--font-extrabold);
            font-size: 22px;
            letter-spacing: -0.02em;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: inline-block;
        }

        .brand .dot {
            color: var(--primary-500);
            font-weight: var(--font-extrabold);
        }

        /* ========== LAYOUT SYSTEM ========== */

        .app-layout {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 240px;
            background: var(--surface);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            z-index: var(--z-fixed);
            transition: transform var(--transition-base);
        }

        .sidebar-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2);
        }

        .nav-section {
            margin-bottom: var(--space-4);
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            padding: var(--space-2) var(--space-3);
            margin-bottom: var(--space-1);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            border: none;
            background: transparent;
            width: 100%;
        }

        .nav-item:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--primary-50);
            color: var(--primary-600);
            font-weight: var(--font-semibold);
        }

        .nav-item-icon {
            font-size: 18px;
            opacity: 0.9;
        }

        .nav-item-badge {
            margin-left: auto;
            background: var(--primary-100);
            color: var(--primary-700);
            font-size: 11px;
            font-weight: var(--font-semibold);
            padding: 2px 6px;
            border-radius: var(--radius-full);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-phi-3);
            width: 100%;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .page-content {
            width: 100%;
            min-height: 100%;
        }

        /* Utility classes */
        .card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--elevation-1);
            padding: var(--space-4);
            transition: all var(--transition-base);
        }

        .card:hover {
            box-shadow: var(--elevation-3);
            transform: translateY(-2px);
            border-color: var(--border-medium);
        }

        .card-elevated {
            box-shadow: var(--elevation-3);
        }

        .card-elevated:hover {
            box-shadow: var(--elevation-4);
        }

        .section {
            background: transparent;
            border: none;
            padding: 0;
        }

        /* ========== BUTTONS & PILLS ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-medium);
            background: var(--surface);
            color: var(--text-primary);
            box-shadow: var(--elevation-1);
            transition: all var(--transition-fast);
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            font-weight: var(--font-medium);
        }

        .btn:hover {
            border-color: var(--border-strong);
            box-shadow: var(--elevation-2);
            background: var(--surface-hover);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--focus-ring);
        }

        .btn-primary {
            background: var(--primary-500);
            color: white;
            border-color: var(--primary-500);
        }

        .btn-primary:hover {
            background: var(--primary-600);
            border-color: var(--primary-600);
        }

        .btn-ghost {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1.5px solid #cbd5e1;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border-radius: 14px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 5px 10px;
        }

        .btn-ghost:hover {
            background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%);
            border-color: #a78bfa;
            color: #6d28d9;
            box-shadow: 0 2px 4px rgba(124, 58, 237, 0.2);
            transform: translateY(-1px);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: 8px var(--space-phi-1);
            border-radius: var(--radius-full);
            border: 2px solid var(--color-warm-200);
            background: linear-gradient(135deg, var(--surface) 0%, var(--color-cream-50) 100%);
            color: var(--text-secondary);
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            font-size: var(--text-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .pill::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.03) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(10px, -10px);
        }

        .pill:hover {
            background: linear-gradient(135deg, var(--color-cream-50) 0%, var(--color-warm-100) 100%);
            border-color: var(--primary-300);
            color: var(--primary-600);
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 4px 8px rgba(13, 148, 136, 0.15), 0 2px 4px rgba(13, 148, 136, 0.1);
        }

        .pill:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.2);
        }

        .pill[aria-selected="true"],
        .pill.active {
            color: var(--text-inverse);
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-color: var(--primary-600);
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3), 0 2px 6px rgba(13, 148, 136, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .pill[aria-selected="true"]::before,
        .pill.active::before {
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%);
        }

        .pill[aria-selected="true"]:hover,
        .pill.active:hover {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 6px 16px rgba(13, 148, 136, 0.4), 0 3px 8px rgba(13, 148, 136, 0.25);
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            background: #f2f5fc;
            color: var(--muted-text);
            border: 1px solid var(--border);
            font-size: 12px;
            font-weight: 500;
        }

        .input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #fff;
            color: var(--text);
            font-family: inherit;
            font-size: 14px;
        }

        .input::placeholder {
            color: #8a94a6;
        }

        .input:focus {
            outline: none;
            box-shadow: var(--focus);
        }

        .popover {
            position: absolute;
            z-index: 1000;
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            min-width: 240px;
            max-height: 300px;
            overflow: auto;
            padding: 6px;
            transform: translateY(8px);
        }

        .popover-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 8px;
            color: var(--text-dim);
        }

        .popover-item:hover {
            background: #f6f8fe;
            color: var(--text);
        }

        .avatar {
            width: 22px;
            height: 22px;
            border-radius: 9999px;
            display: grid;
            place-items: center;
            background: #e9ecf6;
            color: #55657e;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .divider {
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }

        .team-control {
            position: relative;
        }

        .team-member-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .team-member-contact {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* ========== WORLD-CLASS COMMAND BAR (WARHOL × WRIGHT) ========== */
        .appbar {
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            background: var(--appbar);
            backdrop-filter: saturate(1.2) blur(12px);
            border-bottom: 2px solid var(--color-warm-200);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
            position: relative;
        }

        .appbar::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg,
                var(--primary-600) 0%,
                var(--primary-500) 50%,
                var(--primary-600) 100%);
            opacity: 0.5;
        }

        .appbar-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
            padding: var(--space-3) var(--space-6);
            min-height: 56px;
        }

        .command-bar-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            flex: 1;
        }

        .command-bar-center {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 2;
            max-width: 600px;
        }

        .command-bar-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            justify-content: flex-end;
        }

        .global-search {
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .global-search-input {
            width: 100%;
            padding: var(--space-2) var(--space-3) var(--space-2) 36px;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            background: var(--surface);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all var(--transition-fast);
        }

        .global-search-input:focus {
            outline: none;
            box-shadow: var(--focus-ring);
            border-color: var(--primary-500);
        }

        .global-search-input::placeholder {
            color: var(--text-tertiary);
        }

        .global-search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 16px;
        }

        .pills {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .notifications-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            background: var(--surface);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .notifications-btn:hover {
            background: var(--surface-hover);
            border-color: var(--border-medium);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger-500);
            color: white;
            font-size: 10px;
            font-weight: var(--font-semibold);
            padding: 2px 5px;
            border-radius: var(--radius-full);
            min-width: 18px;
            text-align: center;
        }

        .user-menu-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            background: var(--surface);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .user-menu-btn:hover {
            background: var(--surface-hover);
            border-color: var(--border-medium);
        }

        .user-avatar {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: var(--font-semibold);
        }

        .last-updated {
            font-size: 12px;
            color: var(--muted-text);
            white-space: nowrap;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px var(--space-phi-1);
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--text);
            background: linear-gradient(135deg, var(--surface) 0%, var(--color-cream-50) 100%);
            border: 2px solid var(--color-warm-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.03) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(8px, -8px);
        }

        .refresh-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--color-cream-50) 0%, var(--color-warm-100) 100%);
            border-color: var(--teal-500);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 8px rgba(22, 163, 74, 0.15);
        }

        .refresh-btn:active:not(:disabled) {
            transform: translateY(0) scale(0.98);
        }

        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .refresh-btn.loading .refresh-icon {
            animation: spin 1s linear infinite;
        }

        .refresh-btn.success {
            background: linear-gradient(135deg, var(--emerald-500) 0%, var(--emerald-600) 100%);
            color: var(--text-inverse);
            border-color: var(--emerald-600);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .refresh-btn.error {
            background: linear-gradient(135deg, var(--danger-500) 0%, var(--danger-600) 100%);
            color: var(--text-inverse);
            border-color: var(--danger-600);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .sort-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .sort-btn:hover:not(:disabled) {
            background: var(--pill-hover);
            border-color: var(--border-strong);
            transform: translateY(-1px);
        }

        .sort-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .sort-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .search-container {
            margin-bottom: 12px;
            margin-top: 16px;
        }

        .client-card {
            background: linear-gradient(180deg, #ffffff 0%, var(--color-cream-50) 100%);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: 0 2px 6px rgba(15, 46, 61, 0.06),
                        0 1px 2px rgba(15, 46, 61, 0.03),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9);
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: fit-content;
            position: relative;
            overflow: hidden;
        }

        .client-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg,
                var(--primary-600) 0%,
                var(--primary-500) 100%);
            opacity: 0.8;
        }

        .client-card:hover {
            box-shadow: 0 20px 40px rgba(15, 46, 61, 0.12),
                        0 8px 16px rgba(15, 46, 61, 0.08),
                        inset 0 1px 0 rgba(255, 255, 255, 1);
            transform: translateY(-6px) scale(1.01);
            border-color: var(--primary-400);
        }

        .client-card:hover::before {
            opacity: 1;
        }

        .card-head {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: start;
            gap: 16px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
            background: linear-gradient(180deg, rgba(249, 250, 251, 0.5) 0%, transparent 100%);
            padding: 12px;
            margin: -12px -12px 16px -12px;
            border-radius: 8px 8px 0 0;
        }

        .card-head-left {
            min-width: 0;
        }

        .card-head-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .business-name {
            font-size: var(--text-xl);
            font-weight: var(--font-extrabold);
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-500) 50%, var(--emerald-600) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
            margin: 0 0 8px 0;
            line-height: 1.1;
            position: relative;
            padding-left: 12px;
        }

        .business-name::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(13, 148, 136, 0.2);
        }

        .setter-name-inline {
            font-size: 11px;
            font-weight: 600;
            color: #000000;
        }

        .info-line {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }

        .info-line.address {
            padding: 4px 8px;
            background: linear-gradient(135deg, var(--color-cream-50) 0%, var(--color-warm-100) 100%);
            border-radius: var(--radius-sm);
            border: 1px solid var(--color-warm-200);
            display: inline-block;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .info-line.setter {
            color: var(--text);
            font-weight: 700;
        }

        .owner-block {
            text-align: right;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .owner-contact-line {
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-items: flex-end;
        }

        .owner-name {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 13px;
        }

        .setter-badge {
            font-size: 11px;
            font-weight: 600;
            color: #0d9488;
            background: #ccfbf1;
            border: 1px solid #5eead4;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            align-self: flex-end;
        }

        .client-info {
            margin: 0;
        }

        /* ========== PROFESSIONAL SECTION CARDS ========== */

        .targets-section,
        .licensed-section {
            margin-top: 12px;
            background: linear-gradient(135deg, var(--teal-50) 0%, var(--teal-100) 100%);
            border: 1px solid var(--teal-100);
            border-left: 3px solid var(--teal-500);
            border-radius: var(--radius-md);
            padding: 10px;
            box-shadow: 0 1px 4px rgba(22, 163, 74, 0.06), inset 0 1px 0 rgba(255,255,255,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .targets-section::before,
        .licensed-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(22, 163, 74, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .targets-section:hover,
        .licensed-section:hover {
            box-shadow: 0 8px 16px rgba(22, 163, 74, 0.15), 0 2px 4px rgba(22, 163, 74, 0.1);
            transform: translateY(-2px);
            border-left-width: 6px;
        }

        .targets-section {
            background: linear-gradient(135deg, var(--teal-50) 0%, var(--teal-100) 100%);
            border-color: var(--teal-100);
            border-left-color: var(--teal-500);
        }

        .targets-section .section-label::before {
            content: '';
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
        }

        .licensed-section {
            background: linear-gradient(135deg, var(--emerald-50) 0%, var(--emerald-100) 100%);
            border: 2px solid var(--emerald-100);
            border-left: 5px solid var(--emerald-500);
            box-shadow: 0 2px 8px rgba(6, 182, 212, 0.08), inset 0 1px 0 rgba(255,255,255,0.5);
        }

        .licensed-section::before {
            background: radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%);
        }

        .licensed-section .section-label::before {
            content: '';
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
        }

        .section-label {
            font-size: 12px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: -0.01em;
        }

        .section-label::before {
            content: '';
            width: 5px;
            height: 5px;
            background: currentColor;
            border-radius: 50%;
            box-shadow: 0 0 4px currentColor;
        }

        .collapsible-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: color 0.2s;
        }

        .collapsible-label > span:first-child {
            flex: 1;
        }

        .collapsible-label:hover {
            color: var(--primary);
        }

        .toggle-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
            display: inline-block;
        }

        .collapsible-label.collapsed .toggle-arrow {
            transform: rotate(-90deg);
        }

        .collapsible-hint {
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--text-dim);
            margin-left: 8px;
        }

        .collapsible-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0;
            padding: 0;
        }

        .targets {
            margin: 0;
            padding-left: 18px;
            max-height: 8.5em;
            overflow: auto;
        }

        .targets li {
            list-style: disc;
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.5;
            margin: 3px 0;
        }

        .licensed {
            margin: 0;
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.5;
        }

        /* ========== WORLD-CLASS METRIC DASHBOARD ========== */

        .card-footer {
            display: flex;
            flex-direction: column;
            gap: var(--space-phi-1);
            margin-top: var(--space-phi-2);
            padding-top: var(--space-phi-1);
            border-top: 2px solid var(--border-light);
        }

        .airtable-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-phi-1);
            margin-bottom: var(--space-phi-1);
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid var(--color-warm-200);
            border-left: 2px solid var(--color-warm-300);
            border-radius: var(--radius-sm);
            padding: 6px 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.03) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(15px, -15px);
        }

        .stat-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 1);
            transform: translateY(-3px) scale(1.02);
            border-left-width: 5px;
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--emerald-50) 0%, #ecfdf5 100%);
            border-color: var(--emerald-100);
            border-left-color: var(--emerald-500);
        }

        .stat-card.success::before {
            background: radial-gradient(circle, rgba(6, 182, 212, 0.08) 0%, transparent 70%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--amber-50) 0%, #fefce8 100%);
            border-color: var(--amber-100);
            border-left-color: var(--amber-500);
        }

        .stat-card.warning::before {
            background: radial-gradient(circle, rgba(100, 116, 139, 0.08) 0%, transparent 70%);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #fecaca;
            border-left-color: #ef4444;
        }

        .stat-card.danger::before {
            background: radial-gradient(circle, rgba(239, 68, 68, 0.08) 0%, transparent 70%);
        }

        .stat-label {
            font-size: 9px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 3px;
            font-weight: 700;
        }

        .stat-value {
            font-weight: 900;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 3px;
            letter-spacing: -0.02em;
        }

        .stat-card.success .stat-value {
            color: var(--emerald-600);
        }

        .stat-card.warning .stat-value {
            color: var(--amber-600);
        }

        .stat-card.danger .stat-value {
            color: #dc2626;
        }

        .stat-progress {
            height: 5px;
            background: rgba(0, 0, 0, 0.08);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .stat-progress-bar {
            height: 100%;
            background: currentColor;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
            box-shadow: 0 0 4px currentColor;
        }

        /* Metrics Badge - New Leads + Booked Today */
        .metrics-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #dc5a4b 0%, #c65147 50%, #a8423c 100%);
            border: 2px solid #e8998f;
            border-radius: var(--radius-lg);
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow:
                0 0 13px rgba(214, 0, 0, 0.076),
                0 0 26px rgba(214, 0, 0, 0.052),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .metrics-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.15) 50%,
                transparent 70%
            );
            animation: hammer-shine 5s linear infinite;
        }

        .metrics-badge:hover {
            box-shadow:
                0 0 19px rgba(214, 0, 0, 0.10),
                0 0 38px rgba(214, 0, 0, 0.064),
                inset 0 1px 0 rgba(255, 255, 255, 0.25);
        }

        .metric-item {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .metric-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        .metric-number {
            font-size: 24px;
            font-weight: 900;
            line-height: 1;
        }

        .metric-label-text {
            font-size: 11px;
            font-weight: 600;
            opacity: 0.9;
            line-height: 1.2;
        }

        .setter-badge {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-2);
            padding: 10px var(--space-phi-1);
            background: linear-gradient(135deg, var(--color-cream-50) 0%, var(--color-warm-100) 100%);
            border: 2px solid var(--color-warm-200);
            border-left: 3px solid var(--teal-500);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .setter-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(22, 163, 74, 0.12);
            border-left-width: 4px;
        }

        .ghl-number {
            font-size: var(--text-sm);
            color: var(--status-warning);
            font-weight: 700;
            display: block;
            margin-top: 4px;
            padding: 4px 8px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 6px;
            text-align: center;
        }

        /* HAMMER SECTION - Right half of combined badge */
        .hammer-section {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            background: linear-gradient(135deg, #d60000 0%, #b92626 50%, #991c1c 100%);
            border: 2px solid #fca5a5;
            border-left: 1px solid #fca5a5;
            border-top-right-radius: var(--radius-lg);
            border-bottom-right-radius: var(--radius-lg);
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            text-align: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow:
                0 0 13px rgba(214, 0, 0, 0.38),
                0 0 26px rgba(214, 0, 0, 0.26),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            animation: hammer-pulse 3s ease-in-out infinite;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .hammer-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.15) 50%,
                transparent 70%
            );
            animation: hammer-shine 5s linear infinite;
        }

        .hammer-section:hover {
            box-shadow:
                0 0 19px rgba(214, 0, 0, 0.50),
                0 0 38px rgba(214, 0, 0, 0.32),
                inset 0 1px 0 rgba(255, 255, 255, 0.25);
        }

        /* Hammer text styling */
        .hammer-count {
            font-size: 24px;
            font-weight: 800;
            margin-right: 6px;
        }

        .hammer-text {
            font-size: 13px;
            font-weight: 600;
            line-height: 1.3;
        }

        .hammer-not {
            font-weight: 900;
            font-size: 12px;
        }

        /* Daily Tracking Metrics Layout */
        .hammer-metrics {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .metric-primary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .metric-secondary {
            display: flex;
            gap: 16px;
            justify-content: center;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.25);
            width: 100%;
        }

        .daily-metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .metric-icon {
            font-size: 14px;
            opacity: 0.9;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 900;
            line-height: 1;
        }

        .metric-label {
            font-size: 9px;
            opacity: 0.85;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-align: center;
        }

        @keyframes hammer-pulse {
            0%, 100% {
                box-shadow:
                    0 0 13px rgba(214, 0, 0, 0.38),
                    0 0 26px rgba(214, 0, 0, 0.26),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            50% {
                box-shadow:
                    0 0 19px rgba(214, 0, 0, 0.50),
                    0 0 38px rgba(214, 0, 0, 0.38),
                    0 0 50px rgba(214, 0, 0, 0.26),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        @keyframes hammer-shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .timezone-info {
            font-size: 13px;
            color: var(--text-tertiary);
            margin: 6px 0 0 0;
            line-height: 1.5;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .timezone-info::before {
            content: '';
            width: 5px;
            height: 5px;
            background: var(--primary-500);
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 4px var(--primary-500);
            flex-shrink: 0;
        }

        .setter-info {
            font-size: 13px;
            color: #000000;
            margin: 6px 0 0 0;
            line-height: 1.5;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .clients-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 16px;
            }

            .appbar h1,
            .appbar .brand {
                font-size: 22px;
            }

            .card-head {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .card-head-right {
                align-items: flex-start;
            }

            .owner-block {
                text-align: left;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            .appbar h1,
            .appbar .brand {
                font-size: 20px;
            }

            .pills {
                width: 100%;
            }

            .pill {
                flex: 1;
                justify-content: center;
            }
        }

        @media (max-width: 360px) {
            .clients-grid {
                grid-template-columns: 1fr;
            }

            .client-card {
                padding: 12px;
            }

            .appbar-inner {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .last-updated {
                font-size: 10px;
            }

            .refresh-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
        }

        /* ============= WORLD-CLASS BUTTONS ============= */
        .btn-add-notes {
            margin-top: 6px;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            color: var(--purple-600);
            background: transparent;
            border: 1px solid var(--purple-300);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-add-notes:hover {
            background: var(--purple-50);
            border-color: var(--purple-500);
            color: var(--purple-700);
            transform: translateY(-1px);
        }

        .notes-input-container {
            margin-top: 8px;
            padding: 8px;
            background: var(--bg);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .notes-input {
            width: 100%;
            padding: 6px 8px;
            font-size: 13px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text);
        }

        .notes-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .client-notes-section {
            margin-bottom: 12px;
            margin-top: 0;
            background: linear-gradient(135deg, var(--purple-50) 0%, var(--purple-100) 100%);
            border: 1px solid var(--purple-100);
            border-left: 3px solid var(--purple-500);
            border-radius: var(--radius-md);
            padding: 10px;
            box-shadow: 0 1px 4px rgba(20, 184, 166, 0.06), inset 0 1px 0 rgba(255,255,255,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .client-notes-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(20, 184, 166, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .client-notes-section:hover {
            box-shadow: 0 8px 16px rgba(20, 184, 166, 0.15), 0 2px 4px rgba(20, 184, 166, 0.1);
            transform: translateY(-2px);
            border-left-width: 6px;
        }

        .notes-section-header {
            font-size: var(--text-sm);
            font-weight: 800;
            color: var(--purple-600);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.01em;
        }

        .notes-section-header::before {
            content: '';
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            box-shadow: 0 0 6px currentColor;
        }

        .notes-list {
            list-style: disc;
            padding-left: 20px;
            max-height: 150px;
            overflow-y: auto;
            margin: 0;
        }

        .notes-list li {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 6px 0;
            display: list-item;
            position: relative;
        }

        .note-text {
            display: inline;
        }

        .note-actions {
            display: inline-flex;
            gap: 4px;
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            vertical-align: middle;
        }

        .notes-list li:hover .note-actions {
            opacity: 1;
        }

        .note-edit-btn,
        .note-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 2px 4px;
            transition: transform 0.1s;
        }

        .note-edit-btn:hover {
            transform: scale(1.2);
        }

        .note-delete-btn:hover {
            transform: scale(1.2);
        }

        .note-edit-input {
            width: 100%;
            padding: 4px 6px;
            font-size: 13px;
            border: 1px solid var(--primary);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text);
        }

        .note-edit-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ============= CURRENT CAMPAIGN ============= */
        .current-campaign-section {
            margin-bottom: 12px;
            margin-top: 0;
            background: linear-gradient(135deg, var(--amber-50) 0%, var(--amber-100) 100%);
            border: 1px solid var(--amber-100);
            border-left: 3px solid var(--amber-500);
            border-radius: var(--radius-md);
            padding: 10px;
            box-shadow: 0 1px 4px rgba(100, 116, 139, 0.06), inset 0 1px 0 rgba(255,255,255,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .current-campaign-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(100, 116, 139, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .current-campaign-section:hover {
            box-shadow: 0 8px 16px rgba(100, 116, 139, 0.15), 0 2px 4px rgba(100, 116, 139, 0.1);
            transform: translateY(-2px);
            border-left-width: 6px;
        }

        .campaign-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .campaign-header .section-label::before {
            content: '';
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
            box-shadow: 0 0 6px currentColor;
        }

        .btn-add-campaign {
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 600;
            color: var(--amber-600);
            background: transparent;
            border: 1px solid var(--amber-300);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-add-campaign:hover {
            background: var(--amber-50);
            border-color: var(--amber-500);
            color: var(--amber-700);
            transform: translateY(-1px);
        }

        .campaign-input-container {
            margin-top: 6px;
            padding: 6px;
            background: var(--bg);
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .campaign-input {
            width: 100%;
            padding: 5px 7px;
            font-size: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text);
        }

        .campaign-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .campaign-list {
            list-style: disc;
            padding-left: 20px;
            max-height: 150px;
            overflow-y: auto;
            margin: 0;
            margin-top: 6px;
        }

        .campaign-list li {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 6px 0;
            display: list-item;
            position: relative;
        }

        .campaign-text {
            display: inline;
        }

        .campaign-actions {
            display: inline-flex;
            gap: 4px;
            margin-left: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            vertical-align: middle;
        }

        .campaign-list li:hover .campaign-actions {
            opacity: 1;
        }

        .campaign-edit-btn,
        .campaign-delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 13px;
            padding: 2px 4px;
            transition: transform 0.1s;
        }

        .campaign-edit-btn:hover {
            transform: scale(1.2);
        }

        .campaign-delete-btn:hover {
            transform: scale(1.2);
        }

        .campaign-edit-input {
            width: 100%;
            padding: 4px 6px;
            font-size: 12px;
            border: 1px solid var(--primary);
            border-radius: 4px;
            font-family: inherit;
            color: var(--text);
        }

        .campaign-edit-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ========== CYCLE 2: LOADING & ERROR STATES ========== */

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(250, 251, 252, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-light);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Notification */
        .error-notification {
            position: fixed;
            top: 80px;
            right: 24px;
            max-width: 400px;
            background: var(--surface-elevated);
            border: 1px solid var(--danger-200);
            border-left: 4px solid var(--danger-500);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: start;
            gap: 12px;
            z-index: 10001;
            animation: slideIn 0.3s ease;
        }

        .error-notification.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .error-notification-icon {
            color: var(--danger-500);
            font-size: 20px;
            flex-shrink: 0;
        }

        .error-notification-content {
            flex: 1;
        }

        .error-notification-title {
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .error-notification-message {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .error-notification-close {
            cursor: pointer;
            color: var(--text-tertiary);
            font-size: 18px;
            flex-shrink: 0;
            padding: 0 4px;
            transition: color var(--transition-fast);
        }

        .error-notification-close:hover {
            color: var(--text-primary);
        }

        /* ========== METRICS DASHBOARD ========== */
        .metrics-dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .dashboard-icon {
            font-size: 36px;
            line-height: 1;
        }

        .dashboard-content {
            flex: 1;
        }

        .dashboard-number {
            font-size: 32px;
            font-weight: 900;
            color: #1e293b;
            line-height: 1;
            margin-bottom: 4px;
        }

        .dashboard-label {
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        @media (max-width: 1200px) {
            .metrics-dashboard {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .metrics-dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* ========== ENHANCED CARD UI ========== */

        /* Equal-height card grid */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(390px, 1fr));
            gap: 16px;
            margin-bottom: var(--space-phi-2);
            align-items: stretch; /* Cards stretch to match row height */
        }

        .client-card {
            display: flex;
            flex-direction: column;
            height: 100%; /* Fill grid cell */
            padding: 18px;
        }

        .client-info {
            flex: 1; /* Grows to fill space */
            display: flex;
            flex-direction: column;
            gap: 6px; /* Reduced from 10px */
        }

        .card-footer {
            margin-top: auto; /* Pins footer to bottom */
            gap: 10px;
            padding-top: 10px;
        }

        /* Zone header chips */
        .zone-header-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            margin-bottom: 4px;
        }

        /* ========== INFO BUTTONS ROW ========== */
        .info-buttons-row {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .info-button {
            flex: 1;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .info-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-button.active {
            font-weight: 700;
            box-shadow: 0 0 0 2px currentColor;
        }

        .info-button.notes-btn {
            background: var(--surface-note);
            color: var(--ink-note);
            border-color: var(--border-note);
        }

        .info-button.campaign-btn {
            background: var(--surface-campaign);
            color: var(--ink-campaign);
            border-color: var(--border-campaign);
        }

        .info-button.industries-btn {
            background: var(--surface-industries);
            color: var(--ink-industries);
            border-color: var(--border-industries);
        }

        .info-content {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Notes zone styling */
        .client-notes-section .zone-header-chip {
            background: var(--surface-note);
            color: var(--ink-note);
            border: 1px solid var(--border-note);
        }

        .client-notes-section {
            background: var(--surface-note);
            border: 1px solid var(--border-note);
            border-radius: var(--radius-md);
            padding: 10px;
            margin-bottom: 12px;
        }

        .notes-section-header {
            display: none; /* Replaced by chip */
        }

        /* Campaign zone styling */
        .current-campaign-section .zone-header-chip {
            background: var(--surface-campaign);
            color: var(--ink-campaign);
            border: 1px solid var(--border-campaign);
        }

        .current-campaign-section {
            background: var(--surface-campaign);
            border: 1px solid var(--border-campaign);
            border-radius: var(--radius-md);
            padding: 10px;
            margin-bottom: 12px;
        }

        .current-campaign-section .campaign-header {
            margin-bottom: 0;
        }

        .current-campaign-section .section-label::before {
            display: none; /* Remove bullet dot */
        }

        /* Collapsed state - hide box, show only chip */
        .current-campaign-section.chip-collapsed {
            background: transparent;
            border: none;
            padding: 0;
        }

        .current-campaign-section .zone-header-chip {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .current-campaign-section .zone-header-chip:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Industries zone styling */
        .targets-section .zone-header-chip {
            background: var(--surface-industries);
            color: var(--ink-industries);
            border: 1px solid var(--border-industries);
        }

        .targets-section {
            background: var(--surface-industries);
            border: 1px solid var(--border-industries);
            border-left: 1px solid var(--border-industries); /* Override thick border */
            border-radius: var(--radius-md);
            padding: 10px;
            margin-bottom: 12px;
        }

        .targets-section::before {
            display: none; /* Remove decorative element */
        }

        .targets-section .section-label::before {
            display: none; /* Remove bullet dot */
        }

        /* Collapsed state for Industries */
        .targets-section.chip-collapsed {
            background: transparent;
            border: none;
            padding: 0;
        }

        .targets-section .zone-header-chip {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .targets-section .zone-header-chip:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Target States zone styling */
        .licensed-section .zone-header-chip {
            background: var(--surface-target);
            color: var(--ink-target);
            border: 1px solid var(--border-target);
        }

        .licensed-section {
            background: var(--surface-target);
            border: 1px solid var(--border-target);
            border-left: 1px solid var(--border-target); /* Override thick border */
            border-radius: var(--radius-md);
            padding: 10px;
        }

        .licensed-section::before {
            display: none; /* Remove decorative element */
        }

        /* Replace bullet lists with clean line lists */
        .targets {
            list-style: none;
            padding-left: 0;
            margin: 0;
            line-height: 1.35;
        }

        .targets li {
            padding: 2px 0;
            color: var(--ink-industries);
            font-size: 12px;
            border-bottom: 1px solid rgba(63, 98, 18, 0.1);
        }

        .targets li:last-child {
            border-bottom: none;
        }

        .campaign-list {
            list-style: none;
            padding-left: 0;
        }

        .campaign-list li {
            padding: 3px 0;
            color: var(--ink-campaign);
            font-size: 12px;
            border-bottom: 1px solid rgba(109, 40, 217, 0.1);
        }

        .campaign-list li:last-child {
            border-bottom: none;
        }

        /* Typography improvements */
        .business-name {
            font-size: 19px;
            line-height: 1.3;
        }

        .section-label {
            font-size: 13px;
            line-height: 1.3;
        }

        .licensed {
            font-size: 12px;
            line-height: 1.35;
            color: var(--ink-target);
        }

        /* Micro-interactions */
        .client-card:hover {
            box-shadow: 0 24px 48px rgba(15, 46, 61, 0.14),
                        0 12px 24px rgba(15, 46, 61, 0.10),
                        inset 0 1px 0 rgba(255, 255, 255, 1);
            transform: translateY(-4px) scale(1.005);
        }

        .zone-header-chip:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:focus-visible,
        .btn-add-notes:focus-visible,
        .pill:focus-visible {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }

        /* Skeleton loading state */
        .stat-skeleton {
            background: linear-gradient(90deg, #f0f4f8 25%, #e8f0f2 50%, #f0f4f8 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 4px;
            height: 16px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Updated timestamp */
        .updated-timestamp {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        /* Clamped content with "Show more" */
        .targets.clamped {
            max-height: 90px;
            overflow: hidden;
            position: relative;
        }

        .targets.clamped::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, var(--surface-industries));
        }

        .show-more-btn {
            font-size: 12px;
            color: var(--ink-industries);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 0;
            text-decoration: underline;
            margin-top: 4px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .clients-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Cycle 2: Loading & Error UI -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <div id="errorNotification" class="error-notification">
        <span class="error-notification-icon">⚠️</span>
        <div class="error-notification-content">
            <div class="error-notification-title">Error</div>
            <div class="error-notification-message" id="errorMessage"></div>
        </div>
        <span class="error-notification-close" onclick="hideError()">×</span>
    </div>

    <div class="app-layout">
        <!-- ========== SIDEBAR NAVIGATION ========== -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="brand">LeadForce<span class="dot">.</span></h1>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <button class="nav-item" data-page="dashboard">
                        <span class="nav-item-icon">📊</span>
                        <span>Dashboard</span>
                    </button>
                    <button class="nav-item active" data-page="clients">
                        <span class="nav-item-icon">👥</span>
                        <span>Clients</span>
                        <span class="nav-item-badge" id="clients-count">16</span>
                    </button>
                    <button class="nav-item" data-page="analytics">
                        <span class="nav-item-icon">📈</span>
                        <span>Performance</span>
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Tools</div>
                    <button class="nav-item" data-page="campaigns">
                        <span class="nav-item-icon">🎯</span>
                        <span>Campaigns</span>
                    </button>
                    <button class="nav-item" data-page="reports">
                        <span class="nav-item-icon">📋</span>
                        <span>Reports</span>
                    </button>
                    <button class="nav-item" data-page="team">
                        <span class="nav-item-icon">⚡</span>
                        <span>Team</span>
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <button class="nav-item" data-page="integrations">
                        <span class="nav-item-icon">🔌</span>
                        <span>Integrations</span>
                    </button>
                    <button class="nav-item" data-page="settings">
                        <span class="nav-item-icon">⚙️</span>
                        <span>Settings</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- ========== MAIN CONTENT AREA ========== -->
        <div class="main-content">
            <!-- Enterprise Command Bar -->
            <header class="appbar">
                <div class="appbar-inner">
                    <div class="command-bar-left">
                        <div class="pills" role="tablist">
                            <button class="pill" id="pill-all" type="button" role="tab" aria-selected="true" aria-label="All clients">All</button>
                            <button class="pill" id="pill-brendan" type="button" role="tab" aria-selected="false" aria-label="Brendan clients">Brendan (<span id="count-brendan">9</span>)</button>
                            <button class="pill" id="pill-jacques" type="button" role="tab" aria-selected="false" aria-label="Jacques clients">Jacques (<span id="count-jacques">7</span>)</button>
                        </div>
                    </div>

                    <div class="command-bar-center">
                        <div class="global-search">
                            <span class="global-search-icon">🔍</span>
                            <input
                                class="global-search-input"
                                type="search"
                                id="searchInput"
                                placeholder="Search clients, states, industries..."
                                aria-label="Global search">
                        </div>
                    </div>

                    <div class="command-bar-right">
                        <span id="lastUpdatedDisplay" class="last-updated">Stats updated just now</span>
                        <button id="sortPriorityBtn" class="sort-btn" type="button" aria-label="Sort by priority" title="Sort clients by how far behind they are on goals">
                            <span>⚡</span>
                            <span>Priority</span>
                        </button>
                        <button id="refreshStatsBtn" class="refresh-btn" type="button" aria-label="Refresh stats" title="Refresh appointment stats">
                            <span class="refresh-icon">🔄</span>
                        </button>
                        <button class="notifications-btn" type="button" aria-label="Notifications">
                            <span>🔔</span>
                            <span class="notification-badge">3</span>
                        </button>
                        <button class="user-menu-btn" type="button" aria-label="User menu">
                            <div class="user-avatar">NT</div>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Main Content Scroll Area -->
            <div class="content-area">
                <!-- Clients Page -->
                <div id="page-clients" class="page-content">
                    <div class="container">
                        <!-- Today's Metrics Dashboard -->
                        <div class="metrics-dashboard" id="metricsDashboard">
                            <div class="dashboard-card">
                                <div class="dashboard-icon">📈</div>
                                <div class="dashboard-content">
                                    <div class="dashboard-number" id="totalNewLeads">—</div>
                                    <div class="dashboard-label">New Leads Today</div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-icon">✅</div>
                                <div class="dashboard-content">
                                    <div class="dashboard-number" id="totalBookedToday">—</div>
                                    <div class="dashboard-label">Booked Today</div>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="dashboard-icon">🎯</div>
                                <div class="dashboard-content">
                                    <div class="dashboard-number" id="totalNotConverted">—</div>
                                    <div class="dashboard-label">Total Not Converted</div>
                                </div>
                            </div>
                        </div>

                        <div class="clients-grid" id="clientsGrid">
                            <!-- Client cards will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Placeholder for other pages -->
                <div id="page-other" class="page-content" style="display: none;">
                    <!-- Dynamic content for other pages -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============= AUTONOMOUS SPRINT INFRASTRUCTURE =============
        // Added: Cycle 1 - Foundation & Feature Flags

        // FEATURE FLAGS SYSTEM
        // Enables safe rollout of new features (default OFF until verified)
        window.FeatureFlags = {
            _flags: JSON.parse(localStorage.getItem('featureFlags') || '{}'),

            enabled(flagName) {
                return this._flags[flagName] === true;
            },

            set(flagName, value) {
                this._flags[flagName] = !!value;
                localStorage.setItem('featureFlags', JSON.stringify(this._flags));
                console.log(`[FeatureFlags] ${flagName} = ${value}`);
            },

            getAll() {
                return {...this._flags};
            },

            reset() {
                this._flags = {};
                localStorage.removeItem('featureFlags');
            }
        };

        // METRICS COLLECTION SYSTEM
        // Tracks performance and errors for cycle-over-cycle comparison
        window.APP_METRICS = {
            _metrics: [],
            _errors: [],
            _startTime: performance.now(),

            log(category, metric, value) {
                const entry = {
                    timestamp: Date.now(),
                    category,
                    metric,
                    value
                };
                this._metrics.push(entry);
                if (this._metrics.length > 1000) this._metrics.shift(); // cap size
            },

            logError(error, context = {}) {
                const entry = {
                    timestamp: Date.now(),
                    message: error.message || String(error),
                    stack: error.stack,
                    context
                };
                this._errors.push(entry);
                if (this._errors.length > 100) this._errors.shift(); // cap size
                console.error('[APP_METRICS]', error, context);
            },

            mark(label) {
                performance.mark(label);
            },

            measure(name, startMark, endMark) {
                try {
                    performance.measure(name, startMark, endMark);
                    const measure = performance.getEntriesByName(name)[0];
                    this.log('performance', name, measure.duration);
                    return measure.duration;
                } catch (e) {
                    // marks may not exist yet
                }
            },

            getMetrics() {
                return [...this._metrics];
            },

            getErrors() {
                return [...this._errors];
            },

            getSummary() {
                return {
                    uptime: performance.now() - this._startTime,
                    totalMetrics: this._metrics.length,
                    totalErrors: this._errors.length,
                    flags: FeatureFlags.getAll()
                };
            }
        };

        // Mark app start
        APP_METRICS.mark('app-start');

        // ============= GOHIGHLEVEL INTEGRATION =============
        // GHL API Configuration - Stores API key and settings
        const GHL_CONFIG = {
            apiKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjb21wYW55X2lkIjoiQmVVV08wQ3dYTVd2RjBHNTRmMHkiLCJ2ZXJzaW9uIjoxLCJpYXQiOjE3NjAyODk0MDg5OTksInN1YiI6InI2Q0xpaUUzeUVRbTdQTEEwYnJCIn0.eTjnipcnX7rZNsBfhDRlfrOxxd8u7n2Ip8o2kyTsiT0',
            apiBase: 'https://services.leadconnectorhq.com',
            apiVersion: '2021-07-28',
            refreshInterval: 300000, // 5 minutes
            hammerStageId: null, // Will be set after first API call
            pipelineId: null, // Will be set after first API call
            // Known Hammer stage IDs per location (fallback)
            knownHammerStages: {
                'EkiIDaFam2lOvxlhECE4': 'c6bb9e41-51f4-49a6-8082-6fa2a9735de8', // Insurance Express (59 opps)
                '1COZfVJIMdxWtPrV17RE': '6d5428cb-24fa-44db-86de-e6e277ad0a73', // Insurable (16 opps)
                'IyfLhHUtUSEGC6sDkauA': '8df9477b-4bf6-4fd0-ba16-078f06e5d864', // Allee (40 opps)
                '4jMh4q9PAs921dPUZGEL': '4bd3b6cd-52a6-4592-8e05-5d36869f035c', // GRIT (44 opps)
                'gcDYazA58KKPXAcfsSHQ': 'fdecf2cc-90f3-43f6-b1c1-dd543c683876', // Gerety (67 opps)
                'uGudtHjAyBG3UolKDMda': '3255f4c7-6eab-455c-954e-14d321c54e80', // Koosh (28 opps)
                'hJH7L11qfWiyGXCd4gyV': '504bfe13-8766-4d9a-833e-cf7cd74367c8', // Maudsley (20 opps)
                'FEdg29Kizi5i4UVFEbjc': '9da1fd2c-26b1-4ee5-9d53-a448b3a46f35', // Premier (129 opps)
                'fVxI0k6yEhyJQacx8enT': '6bac0f18-46a6-4b19-9c74-153342b7184f', // Arroyo (4 opps)
                'o5Lq7b7mWEgDRNIEoaNE': '59eddbb8-d697-4f15-8487-7d89ac3ac26f', // WeeR (21 opps)
                'KxE9qitLCdmlPfDiwgsw': '601306c4-3566-4039-9514-ff7eab6fa77f', // Eastman (30 opps)
                'oKsqbPOGI1Fd9hUDLewN': '500a5391-294e-4479-9903-c1d8ee417721', // IMD (30 opps)
                'dBcyaBOKp4JqLi0SRBjw': 'd3918d2a-128c-4592-b032-1ab8bfd35bf1', // Ingram (24 opps)
                'o2QJuDTtlc4N1vemeE0K': 'c7139d7f-bee5-492a-ad16-c9b1a7565c2f', // Bulow (39 opps)
                '9K6TgXyvT1P2VCw52XBR': 'd613fa92-b8be-45eb-8be8-03374d5d7fe7', // UWIB (8 opps)
                'fcmPx72oDbTZEfoYnISE': '196cf188-171e-4556-9e57-1c5ae7dc720b'  // PRIME (20 opps)
            }
        };

        // GHL Data Cache - Stores opportunity counts per location
        const GHL_CACHE = {
            data: new Map(), // locationId -> { count, timestamp, hammerStageId }
            lastFetch: null,

            get(locationId) {
                return this.data.get(locationId);
            },

            set(locationId, count, hammerStageId = null, dailyTracking = null) {
                this.data.set(locationId, {
                    count,
                    hammerStageId,
                    timestamp: Date.now(),
                    dailyTracking: dailyTracking
                });
            },

            isStale(locationId, maxAge = 300000) { // 5 minutes default
                const cached = this.data.get(locationId);
                if (!cached) return true;
                return (Date.now() - cached.timestamp) > maxAge;
            },

            clear() {
                this.data.clear();
                this.lastFetch = null;
            }
        };

        // GHL Daily Tracking System - Tracks leads generated/converted per day
        const GHL_DAILY_TRACKER = {
            _storageKey: 'ghl_daily_tracking',

            // Load all tracking data from localStorage
            load() {
                try {
                    const raw = localStorage.getItem(this._storageKey);
                    return raw ? JSON.parse(raw) : {};
                } catch (error) {
                    console.error('[Daily Tracker] Error loading from localStorage:', error);
                    return {};
                }
            },

            // Save all tracking data to localStorage
            save(data) {
                try {
                    localStorage.setItem(this._storageKey, JSON.stringify(data));
                } catch (error) {
                    console.error('[Daily Tracker] Error saving to localStorage:', error);
                }
            },

            // Get tracking data for a specific location
            get(locationId) {
                const allData = this.load();
                return allData[locationId] || null;
            },

            // Set tracking data for a specific location
            set(locationId, trackingData) {
                const allData = this.load();
                allData[locationId] = trackingData;
                this.save(allData);
            },

            // Initialize tracking for new location
            init(locationId, currentCount) {
                const tracking = {
                    baselineCount: currentCount,
                    lastKnownCount: currentCount,
                    generatedToday: 0,
                    convertedToday: 0,
                    lastResetDate: this._getTodayDate(),
                    lastUpdateTime: Date.now()
                };
                console.log(`[Daily Tracker] Initialized tracking for ${locationId}:`, tracking);
                return tracking;
            },

            // Helper: Get today's date as YYYY-MM-DD
            _getTodayDate() {
                return new Date().toISOString().split('T')[0];
            },

            // Check if it's a new day (needs reset)
            isNewDay(lastResetDate) {
                return this._getTodayDate() !== lastResetDate;
            },

            // Clear all tracking data (for debugging)
            clearAll() {
                localStorage.removeItem(this._storageKey);
                console.log('[Daily Tracker] All tracking data cleared');
            }
        };

        // Update daily tracking with delta detection
        function updateDailyTracking(locationId, currentCount, businessName = '') {
            // Load existing tracking data
            let tracking = GHL_DAILY_TRACKER.get(locationId);

            // Initialize if first time
            if (!tracking) {
                console.log(`[Daily Tracker] First time tracking for ${businessName || locationId}`);
                tracking = GHL_DAILY_TRACKER.init(locationId, currentCount);
                GHL_DAILY_TRACKER.set(locationId, tracking);
                return tracking;
            }

            // Check for new day → reset counters
            if (GHL_DAILY_TRACKER.isNewDay(tracking.lastResetDate)) {
                console.log(`[Daily Tracker] 🌅 New day detected for ${businessName || locationId} - Resetting counters`);
                tracking = {
                    baselineCount: currentCount,
                    lastKnownCount: currentCount,
                    generatedToday: 0,
                    convertedToday: 0,
                    lastResetDate: GHL_DAILY_TRACKER._getTodayDate(),
                    lastUpdateTime: Date.now()
                };
                GHL_DAILY_TRACKER.set(locationId, tracking);
                return tracking;
            }

            // Calculate delta from last known count
            const delta = currentCount - tracking.lastKnownCount;

            if (delta > 0) {
                // Leads added
                tracking.generatedToday += delta;
                console.log(`[Daily Tracker] 📈 +${delta} leads generated for ${businessName || locationId} (Total today: ${tracking.generatedToday})`);
            } else if (delta < 0) {
                // Leads removed (converted)
                const removed = Math.abs(delta);
                tracking.convertedToday += removed;
                console.log(`[Daily Tracker] ✅ ${removed} leads converted for ${businessName || locationId} (Total today: ${tracking.convertedToday})`);
            } else {
                // No change
                console.log(`[Daily Tracker] No change for ${businessName || locationId}`);
            }

            // Update last known count and timestamp
            tracking.lastKnownCount = currentCount;
            tracking.lastUpdateTime = Date.now();

            // Persist to localStorage
            GHL_DAILY_TRACKER.set(locationId, tracking);

            return tracking;
        }

        // Hybrid Metrics: Airtable (leads/bookings) + GHL (not converted count)

        /**
         * Fetch today's metrics using hybrid approach:
         * - Leads Today: GHL (opportunities entering Hammer stage today)
         * - Booked Today: Airtable (New Appointments Today)
         * - Total NOT Converted: GHL (all opportunities in Hammer)
         *
         * @param {Object} client - Client with ghlLocationId, ghlToken, businessName
         * @returns {Promise<Object>} { newLeadsToday, bookedToday, totalInHammer }
         */
        async function fetchTodayMetrics(client) {
            console.log(`[Metrics] Fetching for ${client.businessName}`);

            if (!client.ghlLocationId || !client.ghlToken) {
                console.log(`[Metrics] ${client.businessName} - No GHL integration`);
                return null;
            }

            try {
                // Get Hammer stage ID
                const hammerStageId = GHL_CONFIG.knownHammerStages[client.ghlLocationId];
                if (!hammerStageId) {
                    console.warn(`[Metrics] ${client.businessName} - No Hammer stage ID configured`);
                    return null;
                }

                // Fetch GHL opportunities
                const url = `${GHL_CONFIG.apiBase}/opportunities/search?location_id=${client.ghlLocationId}&limit=100`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${client.ghlToken}`,
                        'Version': GHL_CONFIG.apiVersion,
                        'Accept': 'application/json'
                    },
                    timeout: 10000
                });

                if (!response.ok) {
                    throw new Error(`GHL API error: ${response.status}`);
                }

                const data = await response.json();
                const opportunities = data.opportunities || [];

                // Calculate EST/EDT today start (always uses America/New_York timezone)
                const now = new Date();

                // Get today's date in Eastern timezone as ISO string
                const estString = now.toLocaleString('en-US', {
                    timeZone: 'America/New_York',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });

                // Parse: "MM/DD/YYYY, HH:mm:ss"
                const [datePart] = estString.split(', ');
                const [month, day, year] = datePart.split('/');

                // Create Date object for midnight Eastern time
                // Use a reliable method: create the date string and let browser parse it
                const midnightEST = new Date(`${year}-${month}-${day}T00:00:00-05:00`); // EST offset
                const midnightEDT = new Date(`${year}-${month}-${day}T00:00:00-04:00`); // EDT offset

                // Determine which offset is currently active
                const nowEST = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
                const nowUTC = new Date(now.toLocaleString('en-US', { timeZone: 'UTC' }));
                const currentOffset = (nowUTC - nowEST) / 3600000; // Hours difference

                // Use the correct midnight based on current DST status
                const utcTodayStart = currentOffset === 5 ? midnightEST : midnightEDT;

                // Count metrics from GHL
                let newLeadsToday = 0;
                let totalInHammer = 0;

                for (const opp of opportunities) {
                    const inHammer = opp.pipelineStageId === hammerStageId;

                    if (inHammer) {
                        totalInHammer++;

                        // Check if moved to Hammer today
                        const lastChange = new Date(opp.lastStageChangeAt);
                        if (lastChange >= utcTodayStart) {
                            newLeadsToday++;
                        }
                    }
                }

                // Get bookings from Airtable cache
                let bookedToday = 0;
                const recordId = AIRTABLE_CONFIG.businessNameMap[client.businessName];
                if (recordId && airtableStatsCache && airtableStatsCache[recordId]) {
                    bookedToday = airtableStatsCache[recordId].newAppointmentsToday || 0;
                }

                console.log(`[Metrics] ${client.businessName} - GHL: ${newLeadsToday} new to Hammer, ${totalInHammer} total | Airtable: ${bookedToday} booked`);

                return {
                    newLeadsToday,
                    bookedToday,
                    totalInHammer
                };
            } catch (error) {
                console.error(`[Metrics] ${client.businessName} - Error:`, error);
                return null;
            }
        }

        async function fetchGHLHammerCount(client) {
            console.log(`[GHL API] Fetching count for ${client.businessName}`);

            // Skip if no GHL integration
            if (!client.ghlLocationId || !client.ghlToken) {
                console.log(`[GHL API] ${client.businessName} - Missing credentials`);
                return null;
            }

            // Check cache first
            const cached = GHL_CACHE.get(client.ghlLocationId);
            if (cached && !GHL_CACHE.isStale(client.ghlLocationId)) {
                console.log(`[GHL API] ${client.businessName} - Using cached count: ${cached.count}`);
                return cached.count;
            }

            try {
                // Get Hammer stage ID - try known stages first, then cached, then discover
                let hammerStageId = GHL_CONFIG.knownHammerStages[client.ghlLocationId] || cached?.hammerStageId;

                if (!hammerStageId) {
                    console.log(`[GHL API] ${client.businessName} - Discovering Hammer stage...`);
                    // Need to discover it first
                    const pipelineData = await discoverGHLPipeline(client);
                    if (!pipelineData) {
                        console.error(`[GHL API] Could not discover Hammer stage for ${client.businessName}`);
                        return null;
                    }
                    hammerStageId = pipelineData.hammerStageId;
                    console.log(`[GHL API] ${client.businessName} - Discovered Hammer stage: ${hammerStageId}`);
                } else {
                    console.log(`[GHL API] ${client.businessName} - Using known Hammer stage: ${hammerStageId}`);
                }

                // Now fetch opportunities with the correct stage ID
                console.log(`[GHL API] ${client.businessName} - Fetching opportunities from ${GHL_CONFIG.apiBase}/opportunities/search...`);

                const url = `${GHL_CONFIG.apiBase}/opportunities/search?location_id=${client.ghlLocationId}&limit=1`;
                console.log(`[GHL API] Request URL: ${url}`);

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${client.ghlToken}`,
                        'Version': GHL_CONFIG.apiVersion,
                        'Accept': 'application/json'
                    }
                });

                console.log(`[GHL API] ${client.businessName} - Response status: ${response.status}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`[GHL API] ${client.businessName} - API error: ${response.status}`, errorText);
                    return null;
                }

                const data = await response.json();
                console.log(`[GHL API] ${client.businessName} - Response data:`, data);

                // Extract Hammer stage count from aggregations
                const aggregations = data.aggregations?.pipelines?.buckets || [];
                console.log(`[GHL API] ${client.businessName} - Aggregations:`, aggregations);

                const hammerBucket = aggregations.find(b => b.key === hammerStageId);
                console.log(`[GHL API] ${client.businessName} - Hammer bucket:`, hammerBucket);

                const hammerCount = hammerBucket?.docCount ?? 0;

                console.log(`[GHL API] ✅ ${client.businessName} - Found ${hammerCount} opportunities in Hammer stage`);

                // Update daily tracking (delta detection)
                const tracking = updateDailyTracking(client.ghlLocationId, hammerCount, client.businessName);

                // Cache the result with stage ID and tracking data
                GHL_CACHE.set(client.ghlLocationId, hammerCount, hammerStageId, {
                    generatedToday: tracking.generatedToday,
                    convertedToday: tracking.convertedToday,
                    baselineCount: tracking.baselineCount
                });

                return hammerCount;
            } catch (error) {
                console.error(`[GHL API] ❌ Failed to fetch GHL data for ${client.businessName}:`, error);
                console.error(`[GHL API] Error stack:`, error.stack);
                return null;
            }
        }

        // Discover pipeline and Hammer stage for a location
        async function discoverGHLPipeline(client) {
            if (!client.ghlLocationId || !client.ghlToken) {
                return null;
            }

            try {
                const response = await fetch(
                    `${GHL_CONFIG.apiBase}/opportunities/pipelines?locationId=${client.ghlLocationId}`,
                    {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${client.ghlToken}`,
                            'Version': GHL_CONFIG.apiVersion,
                            'Accept': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    console.warn(`Failed to discover pipelines for ${client.businessName}`);
                    return null;
                }

                const data = await response.json();
                const pipelines = data.pipelines || [];

                // Find "Setter" or "Elite" pipeline
                const setterPipeline = pipelines.find(p =>
                    p.name.toLowerCase().includes('setter') ||
                    p.name.toLowerCase().includes('elite')
                );

                if (!setterPipeline) {
                    console.warn(`No Setter pipeline found for ${client.businessName}`);
                    return null;
                }

                // Find "Hammer" stage
                const hammerStage = setterPipeline.stages.find(s =>
                    s.name.toLowerCase().includes('hammer')
                );

                if (!hammerStage) {
                    console.warn(`No Hammer stage found in ${setterPipeline.name}`);
                    return null;
                }

                return {
                    pipelineName: setterPipeline.name,
                    pipelineId: setterPipeline.id,
                    hammerStageId: hammerStage.id,
                    hammerStageName: hammerStage.name
                };
            } catch (error) {
                console.error(`Discovery failed for ${client.businessName}:`, error);
                return null;
            }
        }

        // Discover Booked Appointment stage ID for a client
        async function discoverBookedStageId(client) {
            if (!client.ghlLocationId || !client.ghlToken) {
                return null;
            }

            try {
                const response = await fetch(
                    `${GHL_CONFIG.apiBase}/opportunities/pipelines?locationId=${client.ghlLocationId}`,
                    {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${client.ghlToken}`,
                            'Version': GHL_CONFIG.apiVersion,
                            'Accept': 'application/json'
                        }
                    }
                );

                if (!response.ok) {
                    console.warn(`[Booked Stage Discovery] Failed for ${client.businessName}: ${response.status}`);
                    return null;
                }

                const data = await response.json();
                const pipelines = data.pipelines || [];

                // Find "Setter" or "Elite" pipeline
                const setterPipeline = pipelines.find(p =>
                    p.name.toLowerCase().includes('setter') ||
                    p.name.toLowerCase().includes('elite')
                );

                if (!setterPipeline) {
                    console.warn(`[Booked Stage Discovery] No Setter pipeline found for ${client.businessName}`);
                    return null;
                }

                // Search for booked appointment stage with various name patterns
                const bookedStage = setterPipeline.stages.find(s => {
                    const name = s.name.toLowerCase();
                    return name.includes('booked') ||
                           name.includes('appointment') ||
                           name.includes('follow up call booked') ||
                           name.includes('quote call booked') ||
                           name.includes('demo scheduled') ||
                           name.includes('meeting set');
                });

                if (!bookedStage) {
                    console.warn(`[Booked Stage Discovery] No Booked stage found in ${setterPipeline.name} for ${client.businessName}`);
                    console.log(`[Booked Stage Discovery] Available stages:`, setterPipeline.stages.map(s => s.name));
                    return null;
                }

                console.log(`[Booked Stage Discovery] ✅ ${client.businessName} - Found: "${bookedStage.name}" (${bookedStage.id})`);
                return {
                    stageId: bookedStage.id,
                    stageName: bookedStage.name
                };
            } catch (error) {
                console.error(`[Booked Stage Discovery] Error for ${client.businessName}:`, error);
                return null;
            }
        }

        // Batch discover booked stage IDs for all clients
        async function batchDiscoverBookedStages() {
            console.log('[Booked Stage Discovery] Starting batch discovery for all clients...');
            const results = {};

            for (const client of clients) {
                if (!client.ghlLocationId || !client.ghlToken) {
                    console.log(`[Booked Stage Discovery] ⏭️  Skipping ${client.businessName} - No GHL integration`);
                    continue;
                }

                const result = await discoverBookedStageId(client);
                if (result) {
                    results[client.ghlLocationId] = result.stageId;
                    console.log(`[Booked Stage Discovery] '${client.ghlLocationId}': '${result.stageId}', // ${client.businessName} - ${result.stageName}`);
                } else {
                    console.warn(`[Booked Stage Discovery] ❌ Failed to discover for ${client.businessName}`);
                }

                // Small delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            console.log('[Booked Stage Discovery] ═══════════════════════════════════');
            console.log('[Booked Stage Discovery] COMPLETE BOOKEDSTAGEIDS OBJECT:');
            console.log('[Booked Stage Discovery] const bookedStageIds = {');
            for (const [locationId, stageId] of Object.entries(results)) {
                const client = clients.find(c => c.ghlLocationId === locationId);
                console.log(`[Booked Stage Discovery]     '${locationId}': '${stageId}', // ${client?.businessName || 'Unknown'}`);
            }
            console.log('[Booked Stage Discovery] };');
            console.log('[Booked Stage Discovery] ═══════════════════════════════════');

            return results;
        }

        // ============= CYCLE 2: ERROR HANDLING & LOADING HELPERS =============

        function showLoading() {
            if (!FeatureFlags.enabled('errorHandlingV1')) return;
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.classList.add('active');
        }

        function hideLoading() {
            if (!FeatureFlags.enabled('errorHandlingV1')) return;
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.classList.remove('active');
        }

        function showError(message) {
            if (!FeatureFlags.enabled('errorHandlingV1')) return;
            const notification = document.getElementById('errorNotification');
            const messageEl = document.getElementById('errorMessage');
            if (notification && messageEl) {
                messageEl.textContent = message;
                notification.classList.add('active');
                // Auto-hide after 8 seconds
                setTimeout(() => hideError(), 8000);
            }
        }

        function hideError() {
            const notification = document.getElementById('errorNotification');
            if (notification) notification.classList.remove('active');
        }

        // ============= ARCHITECTURE NOTES =============
        // Structure: Monolithic HTML file (3104 lines)
        // - Lines 1-1542: CSS (design system, components, responsive)
        // - Lines 1543+: JavaScript (data, rendering, events, Airtable)
        //
        // Data Flow:
        // 1. Hard-coded clients array (line 1545+)
        // 2. Airtable API fetch for stats (AIRTABLE_CONFIG)
        // 3. localStorage for campaigns & edits
        // 4. Render functions generate HTML strings
        //
        // Coupling Points (future extraction targets):
        // - Data layer: clients array, localStorage access, Airtable API
        // - Rendering: renderClients(), renderClientCampaigns(), etc.
        // - Event handlers: inline + delegated listeners
        // - State: filterState, selectedClient, etc.
        //
        // Feature Flags (toggle in console):
        // FeatureFlags.set('flagName', true/false)
        // FeatureFlags.enabled('flagName')

        // HARDCODED CLIENT DATA
        const clients = [
            {
                businessName: "Allee Agency Inc.",
                ownerName: "Jamie Allee",
                ownerPhone: "970-274-3352",
                ownerEmail: "jamie@alleeins.com",
                website: "https://www.alleeins.com/",
                address: "330 Mallory Station Rd. A2, TN 37067",
                timezone: "Central Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "IyfLhHUtUSEGC6sDkauA",
                ghlToken: "pit-455eebff-edb1-4464-accc-a16397903712",
                licensedStates: ["AL", "AZ", "CA", "CO", "GA", "KY", "MD", "MS", "MO", "NE", "TN", "TX", "UT", "VA"],
                targetIndustries: ["Construction", "Restaurants", "Retail - Main Street", "PROPERTY - LRO", "PRIVATE PRACTICE Doctors/Dentists"],
                brokers: [
                    {name: "Ryan Allee", phone: "6157175652", email: "ryan@alleeins.com"},
                    {name: "Will Rogers", phone: "6156648321", email: "will@alleeins.com"},
                    {name: "Jim McKee", phone: "6153770017", email: "jim@alleeins.com"},
                    {name: "Rayneshia Dawkins", phone: "6157169945", email: "rayneshia@alleeins.com"}
                ]
            },
            {
                businessName: "Arroyo Insurance Services - South Bay",
                ownerName: "Robert Kelly",
                ownerPhone: "310-356-8206",
                ownerEmail: "robertk@arroyoins.com",
                website: "www.arroyosouthbay.com",
                address: "5000 E Spring Street, Suite 570, Long Beach, CA 90815",
                timezone: "Pacific Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "fVxI0k6yEhyJQacx8enT",
                ghlToken: "pit-c59b88cb-87e2-4c83-bca2-d02af75975d2",
                licensedStates: ["CA"],
                targetIndustries: ["Wholesale Distribution", "Manufacturing", "Commercial Real Estate - Industrial, Shopping Centers, Apartments, Property Managers", "Construction - Solar, Roofing, Plumbing, HVAC", "Hospitality - Restaurants, Bar/Tavern"],
                brokers: [
                    {name: "Robert Kelly", phone: "3103568206", email: "robertk@arroyoins.com"},
                    {name: "Ryan McDonald", phone: "4243985624", email: "ryanm@arroyoins.com"},
                    {name: "Seamus McDonald", phone: "3103568214", email: "seamusm@arroyoins.com"},
                    {name: "William Dessert", phone: "3103568210", email: "williamd@arroyoins.com"}
                ]
            },
            {
                businessName: "The Bulow Group, Inc",
                ownerName: "TOM Bulow",
                ownerPhone: "708-906-6300",
                ownerEmail: "tbulow@thebulowgroup.com",
                website: "thebulowgroup.com",
                address: "8101 183rd Street, IL 60487",
                timezone: "Central Standard Time",
                setter: "Brendan Butler",
                licensedStates: ["IL"],
                targetIndustries: ["Restaurant Groups", "Construction", "Hardware Stores", "Manufacturing/Food Distributors", "Waste Haulers & Garbage"],
                brokers: [
                    {name: "Nick Hogevenn", phone: "", email: ""},
                    {name: "Tom DeMatteo", phone: "", email: ""},
                    {name: "Bobby Daw", phone: "", email: ""},
                    {name: "Rob Randick", phone: "", email: ""}
                ],
                ghlLocationId: "o2QJuDTtlc4N1vemeE0K",
                ghlToken: "pit-cba1e5c6-2712-40bd-b24e-45771e63d684"
            },
            {
                businessName: "WEER INSURANCE AND FINANCIAL SERVICES, INC",
                ownerName: "Scott Weer",
                ownerPhone: "309-303-2698",
                ownerEmail: "scott@weeryouragent.com",
                website: "www.weeryouragent.com",
                address: "2409 WESTWARD DR, Illinois 60081",
                timezone: "Central Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "o5Lq7b7mWEgDRNIEoaNE",
                ghlToken: "pit-fb2f0fa0-aa2d-4ce2-bbc7-8200aaa4045d",
                licensedStates: ["IL", "IN", "WI", "OH", "FL", "CA", "TX", "GA"],
                targetIndustries: ["Artisian & General Contractors", "Real Estate Investors - Appartment Buildings, Commercial Strip Centers, Condo Associations", "Restaurants", "Bars - only in IL & WI", "Commercial Auto"],
                brokers: [
                    {name: "Tiffany Trevino", phone: "8472781099 ext 104", email: "tiffany@weeryouragent.com"},
                    {name: "Steve Gallardo", phone: "8472781099 ext 102", email: "steve@weeryouragent.com"},
                    {name: "Sherrie Hurley", phone: "8472781099 ext", email: "sherrie@weeryouragent.com"},
                    {name: "Kasia Biedrawa", phone: "8472781099 ext 105", email: "kasia@weeryouragent.com"}
                ]
            },
            {
                businessName: "Insurance Express",
                ownerName: "Raymond Graceffo",
                ownerPhone: "561-345-7332",
                ownerEmail: "raymond@insuranceexpress.com",
                website: "InsuranceExpress.com",
                address: "2005 Vista Parkway Ste 200, FL 33411",
                timezone: "Eastern Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "EkiIDaFam2lOvxlhECE4",
                ghlToken: "pit-a44e3c0a-001e-43ac-bf60-4fa13cb69f19",
                licensedStates: ["FL", "NY"],
                targetIndustries: ["Construction", "Manufacturing", "Commercial Auto (non-trucking)", "Commercial Strip Malls", "Commercial Residential (Apt/Condo)"],
                brokers: [
                    {name: "Charles Maniglia", phone: "", email: "cmaniglia@insuranceexpress.com"}
                ]
            },
            {
                businessName: "UWIB Risk Inc",
                ownerName: "Josh Acosta",
                ownerPhone: "615-234-0347",
                ownerEmail: "josh@uwib.com",
                website: "https://uwibrisk.com/",
                address: "228 Pearl St, Franklin TN, 37064",
                timezone: "Central Standard Time",
                setter: "Brendan Butler",
                licensedStates: ["TN"],
                targetIndustries: ["Artisan Contractors (HVAC, Plumbing, Electrical, Roofing, Etc)", "Restaurants", "Manufacturing", "Property Manager"],
                brokers: [
                    {name: "Eric Schirding", phone: "6265785154", email: "eschirding@uwib.com"},
                    {name: "Jesse Nielsen", phone: "6262046983", email: "jesse@uwib.com"},
                    {name: "David Murphy", phone: "(951) 462-2405", email: "david@uwib.com"}
                ],
                ghlLocationId: "9K6TgXyvT1P2VCw52XBR",
                ghlToken: "pit-b17a595a-a228-404d-ac39-f40424ab6ed3"
            },
            {
                businessName: "Koosh Insurance",
                ownerName: "Itay Sela",
                ownerPhone: "954-495-6965",
                ownerEmail: "itai@koosh-ins.com",
                website: "www.koosh-ins.com",
                address: "4491 S State Road 7, Suite 202, Davie, Florida 33314",
                timezone: "Eastern Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "uGudtHjAyBG3UolKDMda",
                ghlToken: "pit-f16a5f65-9fe1-4a71-bec3-8f89298a97c3",
                licensedStates: ["FL"],
                targetIndustries: ["Commercial Real Estate", "Residential Real Estate", "Restaurants", "Construction", "Hotels"],
                brokers: [
                    {name: "Itay Sela", phone: "9544956965", email: "itai@koosh-ins.com"}
                ]
            },
            {
                businessName: "STATE FARM - TIM MAUDSLEY AGENT",
                ownerName: "TIMOTHY MAUDSLEY",
                ownerPhone: "702-998-4545",
                ownerEmail: "tim@insurancequote-nv.com",
                website: "www.insurancequote-nv.com",
                address: "8170 S EASTERN AVE #11 LAS VEGAS NV 89123",
                timezone: "Pacific Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "hJH7L11qfWiyGXCd4gyV",
                ghlToken: "pit-7a0ec125-fcb7-4557-81ae-54437805dc46",
                licensedStates: ["NV"],
                targetIndustries: ["ARTISAN SERVICE CONTRACTORS", "HOMEOWNERS ASSOCIATIONS", "RESTAURANTS", "AUTO REPAIR", "LESSOR RISK - BUILDING OWNERS"],
                brokers: [
                    {name: "KADEN MAALOUF", phone: "7029984545", email: "KADEN.MAALOUF.VADRFZ@STATEFARM.COM"},
                    {name: "JEREMY WINCHESTER", phone: "7029984545", email: "JEREMY.WINCHESTER.VAB79Y@STATEFARM.COM"},
                    {name: "GABRIELA ANDRADE", phone: "7029984545", email: "GABRIELA.ANDRADE.VADYCA@STATEFARM.COM"}
                ]
            },
            {
                businessName: "Insurable, Inc.",
                ownerName: "Brian Bortz",
                ownerPhone: "412-244-1000",
                ownerEmail: "bkb@insurableinc.com",
                website: "InsurableInc.com",
                address: "1063 Harrison City Export Road, PA 15644",
                timezone: "Eastern Standard Time",
                setter: "Brendan Butler",
                ghlLocationId: "1COZfVJIMdxWtPrV17RE",
                ghlToken: "pit-4cc6b618-ab7c-40ba-a431-4bd2a8b7bf23",
                licensedStates: ["PA"],
                targetIndustries: ["Construction-Artisan", "Workers Comp", "Machine Shops", "Physical fitness facilities GYMS", "Auto Body and Mechanical Shops"],
                brokers: [
                    {name: "Sharie Castle", phone: "(412) 244-1000", email: "SCastle@InsurableInc.com"},
                    {name: "Ron Minnich", phone: "(412) 244-1000", email: "RMinnich@InsurableInc.com"},
                    {name: "Brian Bortz", phone: "(412) 244-1000", email: "Brian@InsurableInc.com"}
                ]
            },
            {
                businessName: "GRIT Insurance",
                ownerName: "Kirk Chester",
                ownerPhone: "801-948-8091",
                ownerEmail: "Kirk@gritinsurance.com",
                website: "www.gritinsurance.com",
                address: "5525 S 900 E Ste 345, UT 84117",
                timezone: "Mountain Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "4jMh4q9PAs921dPUZGEL",
                ghlToken: "pit-137730bd-d390-445f-b5b4-1b0951bb1ae8",
                licensedStates: ["UT", "ID", "CO", "AZ", "TX", "OR", "WA", "CA", "MT", "NV", "ND", "WY"],
                targetIndustries: ["Commercial Contractors", "Landscape Contractors", "Excavation Contractors", "Manufacturing"],
                brokers: [
                    {name: "Kirk Chester", phone: "801-948-8091", email: "Kirk@gritinsurance.com"},
                    {name: "Justin Peterson", phone: "801-948-8090", email: "Justin@gritinsurance.com"},
                    {name: "Easton Rentmeister", phone: "801-948-8092", email: "Easton@gritinsurance.com"}
                ]
            },
            {
                businessName: "Gerety Insurance",
                ownerName: "Rick Gerety",
                ownerPhone: "410-803-2600",
                ownerEmail: "rick@geretyinsurance.com",
                website: "www.geretyinsurance.com",
                address: "406 N Hickory Ave, Bel Air, MD 21014",
                timezone: "Eastern Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "gcDYazA58KKPXAcfsSHQ",
                ghlToken: "pit-4a8d3ca9-96ff-461c-83b1-a2fde1541176",
                licensedStates: ["DE", "MD", "PA", "VA"],
                targetIndustries: ["Construction", "Restaurants", "Manufacturing", "Local Trucking", "Technology"],
                brokers: [
                    {name: "Sully Gerety", phone: "443-686-1115", email: "sully@geretyinsurance.com"},
                    {name: "Cindy Dotson", phone: "443-827-9024", email: "cindy@geretyinsurance.com"}
                ]
            },
            {
                businessName: "IMD INSURANCE & Financial Services LLC",
                ownerName: "Jason Jimenez",
                ownerPhone: "832-754-7808",
                ownerEmail: "jason@imdins.com",
                website: "www.imdins.com",
                address: "8323 SOUTHWEST FREEWAY, Texas 77074",
                timezone: "Central Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "oKsqbPOGI1Fd9hUDLewN",
                ghlToken: "pit-5d57f51d-e22e-4a35-b475-7be1fd8e150c",
                licensedStates: ["TX", "IL", "CA"],
                targetIndustries: ["Construction", "R.E Investors Commercial (Multifamily)", "Professional Services - Attorneys", "MSP's", "Restaurants"],
                brokers: [
                    {name: "Jose Aleman", phone: "+50584758462", email: "jose@imdins.com"},
                    {name: "Marlon Hazsuel", phone: "+50558105735", email: "marlon@imdins.com"}
                ]
            },
            {
                businessName: "PRIME INSURANCE SERVICES",
                ownerName: "MIN CHOI",
                ownerPhone: "201-285-4123",
                ownerEmail: "MIN@PRIMEISERVICES.COM",
                website: "www.primeiservices.com",
                address: "180 Old Tappan Rd. Unit 4203, Old Tappan, NJ 07675",
                timezone: "Eastern Standard Time",
                setter: "Jacques Lebleu",
                licensedStates: ["NJ", "NY", "PA", "TX", "CA", "CT", "FL"],
                targetIndustries: ["CONSTRUCTION", "RESTAURANTS", "BUILDINGS / LESSORS RISK", "WHOLESALER/MFG", "Builder's Risk"],
                brokers: [
                    {name: "MIN CHOI", phone: "2012854123", email: "MIN@PRIMEISERVICES.COM"}
                ],
                ghlLocationId: "fcmPx72oDbTZEfoYnISE",
                ghlToken: "pit-0955f859-08d1-435f-94e9-bcc37bd3af7e"
            },
            {
                businessName: "Ingram Insurance Agency, LLC",
                ownerName: "Chris Ingram",
                ownerPhone: "615-557-5436",
                ownerEmail: "chris@theingramagency.com",
                website: "www.theingramagency.com",
                address: "105 Glen Oak Blvd. Suite 200 Hendersonville, TN 37075",
                timezone: "Central Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "dBcyaBOKp4JqLi0SRBjw",
                ghlToken: "pit-f56eaf86-9937-408d-85ce-7c83148898d9",
                licensedStates: ["NH", "UT", "WY", "AL", "AR", "DE", "FL", "GA", "ID", "IL", "IN", "IA", "KY", "MD", "MN", "MS", "NV", "OH", "OK", "OR", "PA", "SC", "TN", "TX", "VA", "WA", "CO"],
                targetIndustries: ["Artisan Contractor, NO General Contractors", "Restaurants", "Professional Services - anything in an office", "HVAC/ELEC/PLUMBING Contractors", "WORK COMP - All classes"],
                brokers: [
                    {name: "Chris Ingram", phone: "615-675-5154", email: ""}
                ]
            },
            {
                businessName: "Premier Group Insurance",
                ownerName: "Jim Langen",
                ownerPhone: "219-695-3031",
                ownerEmail: "jlangen@premiergrpins.com",
                website: "www.premiergrpins.com",
                address: "829 East Commercial Ave Lowell, Indiana 46356",
                timezone: "Eastern Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "FEdg29Kizi5i4UVFEbjc",
                ghlToken: "pit-8a8f6c62-1350-4a23-bff9-e8a15cd2022a",
                licensedStates: ["IN", "IL", "OH"],
                targetIndustries: ["Construction (1-10)", "Restaurants (Bars)", "Retail (Mom & Pop)", "Condo Association"],
                brokers: [
                    {name: "Michael Langen", phone: "219-695-3034", email: "mlangen@premiergrpins.com"},
                    {name: "James Langen", phone: "219-695-3044", email: "jwlangen@premiergrpins.com"},
                    {name: "Tai Cruise", phone: "219-695-3043", email: "tcruise@premiergrpins.com"},
                    {name: "Jim Snedeker", phone: "219-266-2382", email: "jsnedeker@premiergrpins.com"}
                ]
            },
            {
                businessName: "Eastman Risk Advisors",
                ownerName: "Coltan Eastman",
                ownerPhone: "801-888-0550",
                ownerEmail: "Coltan@Eastmanrisk.com",
                website: "www.eastmanrisk.com",
                address: "270 E 200 S, Clearfield, UT 84015, USA",
                timezone: "Mountain Standard Time",
                setter: "Jacques Lebleu",
                ghlLocationId: "KxE9qitLCdmlPfDiwgsw",
                ghlToken: "pit-05258a71-4fb3-4f03-8ab3-489cb012b7b6",
                licensedStates: ["UT"],
                targetIndustries: ["Commercial property", "Electricians", "Plumbers", "HVAC", "Lube/oil shops"],
                brokers: [
                    {name: "Caleb Beickel", phone: "8018880550", email: "Caleb@Eastmanrisk.com"},
                    {name: "Maddy Beickel", phone: "8018880550", email: "Maddy@Eastmanrisk.com"},
                    {name: "Isabella Brown", phone: "8018880550", email: "Bella@Eastmanrisk.com"},
                    {name: "Mari Higuera", phone: "8018880550", email: "Mari@Eastmanrisk.com"}
                ]
            }
        ];

        // Sort by setter name, then by business name
        clients.sort((a, b) => {
            if (a.setter !== b.setter) {
                return a.setter.localeCompare(b.setter);
            }
            return a.businessName.localeCompare(b.businessName);
        });

        // ============= AIRTABLE INTEGRATION =============
        /**
         * ARCHITECTURE: Hybrid Metrics System
         *
         * Airtable = Single Source of Truth for:
         *   - New Leads Today (from GHL workflows, 100% accurate)
         *   - New Appointments Today (from GHL workflows, 100% accurate)
         *   - Cumulative stats (Appointments Fulfilled, Term Days Remaining)
         *
         * GHL = Real-time data for:
         *   - Hammer Count (leads not yet converted) - updates every 60 seconds
         *
         * Why this approach:
         *   - Airtable has automated workflows that track bookings accurately
         *   - No need to maintain complex pipeline stage ID mappings
         *   - Eliminates undercounting issues caused by missing/wrong stage IDs
         *   - Refresh every 3 minutes keeps daily metrics current
         */
        const AIRTABLE_CONFIG = {
            enabled: true,  // Feature flag - set to false to disable Airtable integration
            baseId: 'app3gCaXd7bblkw7L',
            apiKey: 'patOe0Tj79vik2Qrx.bede69a12d629090462fb258038c527dab560d54ce235edf86bb22d646bd7aa8',
            tableName: 'Clients',
            cacheKey: 'airtable_stats_cache',
            cacheDuration: 5 * 60 * 1000, // 5 minutes (cache validity)
            enableAutoRefresh: true,  // Auto-refresh stats periodically
            autoRefreshInterval: 3 * 60 * 1000, // 3 minutes (actual refresh interval)
            // Business name mapping: cheatsheet name -> Airtable record ID
            // IMPORTANT: Names must match EXACTLY as they appear in Airtable
            businessNameMap: {
                'Allee Agency Inc.': 'recPRIyL2CZJVUC9w',  // Airtable: "Allee Insurance Agency"
                'Arroyo Insurance Services - South Bay': 'recNTECNXB2jhtog5',  // Airtable: "Arroyo Insurance Services"
                'The Bulow Group, Inc': 'recJluC70I0L8cBOT',  // Airtable: "The Bulow Group"
                'WEER INSURANCE AND FINANCIAL SERVICES, INC': 'rec34skN65PsOMBCe',  // Airtable: "Weer Insurance Group"
                'Insurance Express': 'reczJD9aECbk96FSe',
                'UWIB Risk Inc': 'recLrfBzumexwPJkc',  // Airtable: "UWIB Risk & Insurance Solutions"
                'Koosh Insurance': 'rec2iT0U9AN4dxdOH',  // Airtable: "Koosh Insurance " (trailing space)
                'STATE FARM - TIM MAUDSLEY AGENT': 'recuZVguL0dHvNaWT',  // Airtable: "Maudsley Insurance and Financial Services Inc"
                'Insurable, Inc.': 'recmpJDyWHcakpaz2',  // Airtable: "Insurable Inc / Doctors First / Bortz & Associates"
                'GRIT Insurance': 'rec3NFSVF0vIxRNyE',  // Airtable: "Grit Insurance Group"
                'Gerety Insurance': 'recU8yoolD0iqtALP',
                'IMD INSURANCE & Financial Services LLC': 'rec4azH3GpN7DYRmb',  // Airtable: "IMD Insurance"
                'PRIME INSURANCE SERVICES': 'rec6lLT3GB1LVhmFT',  // Airtable: "Prime Services of USA Inc."
                'Ingram Insurance Agency, LLC': 'recUQVVITUegzhddb',
                'Premier Group Insurance': 'recHlyTQlV9su0iHs',
                'Eastman Risk Advisors': 'recMj4HbzVEKXjd1d'
            }
        };

        // Airtable stats cache
        let airtableStatsCache = null;
        let lastStatsUpdate = null;
        let autoRefreshTimer = null;

        // Fetch Airtable stats for all clients
        async function fetchAirtableStats() {
            if (!AIRTABLE_CONFIG.enabled) return null;

            // Cycle 2: Show loading indicator
            showLoading();

            try {
                // Check cache first
                const cached = localStorage.getItem(AIRTABLE_CONFIG.cacheKey);
                if (cached) {
                    const { data, timestamp } = JSON.parse(cached);
                    if (Date.now() - timestamp < AIRTABLE_CONFIG.cacheDuration) {
                        airtableStatsCache = data;
                        lastStatsUpdate = timestamp;
                        hideLoading(); // Cycle 2: Hide loading on cache hit
                        return data;
                    }
                }

                // Fetch from Airtable - now includes daily metrics
                const fields = [
                    'Business Name',
                    'record_id',
                    'Appointments Fulfilled',
                    'Term Days Remaining',
                    'New Appointments Today',
                    'New Leads Today',
                    'Appointments Total'
                ];
                const url = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}?` +
                    fields.map(f => `fields[]=${encodeURIComponent(f)}`).join('&');

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Airtable API error: ${response.status}`);
                }

                const result = await response.json();

                // Build stats map by record ID with enhanced metrics
                const statsMap = {};
                result.records.forEach(record => {
                    const recordId = record.id;
                    const fields = record.fields;
                    statsMap[recordId] = {
                        // Legacy format for card footer (these ARE arrays from Airtable formulas)
                        booked: fields['Appointments Fulfilled'] ? fields['Appointments Fulfilled'][0] : '—/—',
                        daysLeft: fields['Term Days Remaining'] ? fields['Term Days Remaining'][0] : null,
                        // New daily metrics (these are direct integers, NOT arrays)
                        newAppointmentsToday: fields['New Appointments Today'] || 0,
                        newLeadsToday: fields['New Leads Today'] || 0,
                        appointmentsTotal: fields['Appointments Total'] || 0
                    };
                });

                // Cache results
                const now = Date.now();
                airtableStatsCache = statsMap;
                lastStatsUpdate = now;
                localStorage.setItem(AIRTABLE_CONFIG.cacheKey, JSON.stringify({
                    data: statsMap,
                    timestamp: now
                }));

                hideLoading(); // Cycle 2: Hide loading on success
                return statsMap;
            } catch (error) {
                // Cycle 2: Enhanced error handling
                console.error('Error fetching Airtable stats:', error);

                // Log to metrics system
                APP_METRICS.logError(error, {
                    function: 'fetchAirtableStats',
                    airtableEnabled: AIRTABLE_CONFIG.enabled,
                    timestamp: Date.now()
                });

                // Show user-friendly error
                showError('Unable to load client stats. Using cached data if available.');

                hideLoading();
                return null;
            }
        }

        // Get stats for a specific business
        function getStatsForBusiness(businessName) {
            if (!AIRTABLE_CONFIG.enabled || !airtableStatsCache) {
                return { booked: '—/—', daysLeft: '—' };
            }

            const recordId = AIRTABLE_CONFIG.businessNameMap[businessName];
            if (!recordId || !airtableStatsCache[recordId]) {
                return { booked: '—/—', daysLeft: '—' };
            }

            const stats = airtableStatsCache[recordId];
            const daysLeftText = stats.daysLeft !== null
                ? (stats.daysLeft >= 0 ? `${stats.daysLeft}d left` : `${Math.abs(stats.daysLeft)}d over`)
                : '—';

            return {
                booked: stats.booked,
                daysLeft: daysLeftText
            };
        }

        // Render stats for a client card
        function renderStats(cardId, businessName) {
            const statsContainer = document.getElementById(`stats-${cardId}`);
            if (!statsContainer) return;

            const stats = getStatsForBusiness(businessName);

            // Parse booked/goal for progress bar
            let bookedClass = '';
            let progressPercent = 0;
            if (stats.booked !== '—/—') {
                const parts = stats.booked.split('/');
                const booked = parseInt(parts[0]) || 0;
                const goal = parseInt(parts[1]) || 1;
                progressPercent = Math.min((booked / goal) * 100, 100);

                if (progressPercent >= 80) {
                    bookedClass = 'success';
                } else if (progressPercent >= 50) {
                    bookedClass = 'warning';
                } else {
                    bookedClass = 'danger';
                }
            }

            // Determine color class based on days left
            let daysClass = '';
            if (stats.daysLeft !== '—') {
                const daysMatch = stats.daysLeft.match(/(\d+)d/);
                if (daysMatch) {
                    const days = parseInt(daysMatch[1]);
                    if (stats.daysLeft.includes('over')) {
                        daysClass = 'danger';
                    } else if (days <= 7) {
                        daysClass = 'warning';
                    } else if (days >= 20) {
                        daysClass = 'success';
                    }
                }
            }

            statsContainer.innerHTML = `
                <div class="stat-card ${bookedClass}">
                    <div class="stat-label">Booked / Goal</div>
                    <div class="stat-value">${stats.booked}</div>
                    <div class="stat-progress">
                        <div class="stat-progress-bar" style="width: ${progressPercent}%"></div>
                    </div>
                </div>
                <div class="stat-card ${daysClass}">
                    <div class="stat-label">Deadline</div>
                    <div class="stat-value">${stats.daysLeft}</div>
                </div>
            `;
        }

        // Render GHL Hammer count for a client card
        async function renderGHLHammer(cardId, client) {
            const hammerEl = document.getElementById(`hammer-${cardId}`);

            console.log(`[GHL] Rendering Hammer for ${client.businessName}`, {
                cardId,
                hasElement: !!hammerEl,
                hasLocation: !!client.ghlLocationId,
                hasToken: !!client.ghlToken
            });

            if (!hammerEl) {
                console.warn(`[GHL] Element hammer-${cardId} not found!`);
                return;
            }

            if (!client.ghlLocationId || !client.ghlToken) {
                console.log(`[GHL] ${client.businessName} - No GHL integration`);
                hammerEl.textContent = '';
                return;
            }

            try {
                hammerEl.textContent = '🔄 Loading...';
                hammerEl.style.display = 'flex';

                const count = await fetchGHLHammerCount(client);

                console.log(`[GHL] ${client.businessName} - Count: ${count}`);

                // Get tracking data from cache
                const cached = GHL_CACHE.get(client.ghlLocationId);
                const tracking = cached?.dailyTracking || {
                    generatedToday: 0,
                    convertedToday: 0,
                    baselineCount: count
                };

                console.log(`[GHL] ${client.businessName} - Tracking:`, tracking);

                if (count !== null) {
                    hammerEl.innerHTML = `
                        <div class="hammer-metrics">
                            <div class="metric-primary">
                                <span class="hammer-count">${count}</span>
                                <span class="hammer-text">LEADS <span class="hammer-not">NOT</span> CONVERTED</span>
                            </div>
                            <div class="metric-secondary">
                                <div class="daily-metric">
                                    <span class="metric-icon">📈</span>
                                    <span class="metric-value">${tracking.generatedToday}</span>
                                    <span class="metric-label">Generated Today</span>
                                </div>
                                <div class="daily-metric">
                                    <span class="metric-icon">✅</span>
                                    <span class="metric-value">${tracking.convertedToday}</span>
                                    <span class="metric-label">Converted Today</span>
                                </div>
                            </div>
                        </div>
                    `;
                    hammerEl.style.display = 'flex';
                } else {
                    hammerEl.textContent = '⚠️ API Error';
                    hammerEl.style.display = 'flex';
                }
            } catch (error) {
                console.error(`[GHL] Failed to render Hammer count for ${client.businessName}:`, error);
                hammerEl.textContent = '❌ Error';
                hammerEl.style.display = 'flex';
            }
        }

        // Render Today's Metrics for a client card
        async function renderTodayMetrics(cardId, client) {
            const metricsEl = document.getElementById(`metrics-${cardId}`);

            console.log(`[GHL Metrics] Rendering metrics for ${client.businessName}`, {
                cardId,
                hasElement: !!metricsEl,
                hasLocation: !!client.ghlLocationId,
                hasToken: !!client.ghlToken
            });

            if (!metricsEl) {
                console.warn(`[GHL Metrics] Element metrics-${cardId} not found!`);
                return;
            }

            if (!client.ghlLocationId || !client.ghlToken) {
                console.log(`[GHL Metrics] ${client.businessName} - No GHL integration`);
                metricsEl.textContent = '';
                return;
            }

            try {
                metricsEl.textContent = '🔄 Loading metrics...';
                metricsEl.style.display = 'flex';

                const metrics = await fetchTodayMetrics(client);

                console.log(`[GHL Metrics] ${client.businessName} - Results:`, metrics);

                if (metrics !== null) {
                    metricsEl.innerHTML = `
                        <div class="metric-item">
                            <span class="metric-number">${metrics.newLeadsToday}</span>
                            <span class="metric-label-text">Leads Today</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-number">${metrics.bookedToday}</span>
                            <span class="metric-label-text">Booked Today</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-number">${metrics.totalInHammer}</span>
                            <span class="metric-label-text">Total Leads <strong>NOT</strong> Converted Yet</span>
                        </div>
                    `;
                    metricsEl.style.display = 'flex';
                } else {
                    metricsEl.textContent = '⚠️ API Error';
                    metricsEl.style.display = 'flex';
                }
            } catch (error) {
                console.error(`[GHL Metrics] Failed to render metrics for ${client.businessName}:`, error);
                metricsEl.textContent = '❌ Error';
                metricsEl.style.display = 'flex';
            }
        }

        // Update dashboard totals based on visible cards
        async function updateDashboardTotals() {
            console.log('[Dashboard] Updating totals...');

            // Get all visible client cards
            const visibleCards = document.querySelectorAll('.client-card:not([style*="display: none"])');

            let totalNewLeads = 0;
            let totalBooked = 0;
            let totalNotConverted = 0;
            let cardsProcessed = 0;

            for (const card of visibleCards) {
                const cardId = card.id;
                const metricsEl = document.getElementById(`metrics-${cardId}`);

                if (!metricsEl) continue;

                // Extract metrics from the rendered HTML
                const metricNumbers = metricsEl.querySelectorAll('.metric-number');
                if (metricNumbers.length === 3) {
                    totalNewLeads += parseInt(metricNumbers[0].textContent) || 0;
                    totalBooked += parseInt(metricNumbers[1].textContent) || 0;
                    totalNotConverted += parseInt(metricNumbers[2].textContent) || 0;
                    cardsProcessed++;
                }
            }

            console.log(`[Dashboard] Processed ${cardsProcessed} cards: ${totalNewLeads} new, ${totalBooked} booked, ${totalNotConverted} not converted`);

            // Update dashboard display
            document.getElementById('totalNewLeads').textContent = totalNewLeads;
            document.getElementById('totalBookedToday').textContent = totalBooked;
            document.getElementById('totalNotConverted').textContent = totalNotConverted;
        }

        // Refresh all GHL Hammer counts
        async function refreshGHLData() {
            // Clear cache to force fresh fetch
            GHL_CACHE.clear();

            // Re-render all visible client cards with GHL integration
            const visibleCards = document.querySelectorAll('.client-card');

            for (const card of visibleCards) {
                const cardId = card.id;
                const index = parseInt(cardId.replace('card-', ''));
                const client = clients[index];

                if (client?.ghlLocationId && client?.ghlToken) {
                    await renderTodayMetrics(cardId, client);
                }
            }

            // Update dashboard totals after all metrics rendered
            await updateDashboardTotals();
        }

        // Auto-refresh GHL data every 60 seconds
        let ghlRefreshInterval = null;

        function startGHLAutoRefresh() {
            // Clear existing interval if any
            if (ghlRefreshInterval) {
                clearInterval(ghlRefreshInterval);
            }

            // Set up new interval (60 seconds)
            ghlRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing GHL Hammer counts...');
                refreshGHLData();
            }, 60000);
        }

        function stopGHLAutoRefresh() {
            if (ghlRefreshInterval) {
                clearInterval(ghlRefreshInterval);
                ghlRefreshInterval = null;
            }
        }

        // Refresh stats - clear cache and fetch fresh data
        async function refreshStats(showFeedback = true) {
            if (!AIRTABLE_CONFIG.enabled) return;

            try {
                // Show loading state on refresh button if feedback enabled
                if (showFeedback) {
                    const refreshBtn = document.getElementById('refreshStatsBtn');
                    if (refreshBtn) {
                        refreshBtn.classList.add('loading');
                        refreshBtn.disabled = true;
                    }
                }

                // Clear cache to force fresh fetch
                localStorage.removeItem(AIRTABLE_CONFIG.cacheKey);
                airtableStatsCache = null;

                // Fetch fresh data
                await fetchAirtableStats();

                // Re-render stats on all visible cards
                const cards = document.querySelectorAll('.client-card');
                cards.forEach((card, index) => {
                    const cardId = card.id;
                    // Find the matching client by extracting from card attributes
                    const clientId = card.getAttribute('data-client-id');
                    // Find client from our clients array
                    const client = clients.find(c => {
                        const id = c.businessName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
                        return id === clientId;
                    });
                    if (client) {
                        renderStats(cardId, client.businessName);
                    }
                });

                // Update timestamp display
                updateLastUpdatedDisplay();

                // Show success feedback
                if (showFeedback) {
                    const refreshBtn = document.getElementById('refreshStatsBtn');
                    if (refreshBtn) {
                        refreshBtn.classList.remove('loading');
                        refreshBtn.classList.add('success');
                        refreshBtn.disabled = false;
                        setTimeout(() => refreshBtn.classList.remove('success'), 2000);
                    }
                }

            } catch (error) {
                console.error('Error refreshing stats:', error);
                // Show error feedback
                if (showFeedback) {
                    const refreshBtn = document.getElementById('refreshStatsBtn');
                    if (refreshBtn) {
                        refreshBtn.classList.remove('loading');
                        refreshBtn.classList.add('error');
                        refreshBtn.disabled = false;
                        setTimeout(() => refreshBtn.classList.remove('error'), 2000);
                    }
                }
            }
        }

        // Update "last updated" display
        function updateLastUpdatedDisplay() {
            const display = document.getElementById('lastUpdatedDisplay');
            if (!display || !lastStatsUpdate) return;

            const now = Date.now();
            const diffMs = now - lastStatsUpdate;
            const diffMins = Math.floor(diffMs / 60000);

            let text = '';
            if (diffMins < 1) {
                text = 'just now';
            } else if (diffMins === 1) {
                text = '1m ago';
            } else {
                text = `${diffMins}m ago`;
            }

            display.textContent = `Stats updated ${text}`;
        }

        // ============= CLIENT NOTES FUNCTIONS =============
        const NOTES_STORAGE_KEY = 'clientNotes';

        // Get notes for a client
        function getClientNotes(clientId) {
            try {
                const allNotes = localStorage.getItem(NOTES_STORAGE_KEY);
                const notesObj = allNotes ? JSON.parse(allNotes) : {};
                return notesObj[clientId] || [];
            } catch (e) {
                console.error('Error getting notes:', e);
                return [];
            }
        }

        // Save note for a client
        function saveClientNote(clientId, noteText) {
            try {
                const allNotes = localStorage.getItem(NOTES_STORAGE_KEY);
                const notesObj = allNotes ? JSON.parse(allNotes) : {};

                if (!notesObj[clientId]) {
                    notesObj[clientId] = [];
                }

                notesObj[clientId].push(noteText);
                localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(notesObj));
                return true;
            } catch (e) {
                console.error('Error saving note:', e);
                return false;
            }
        }

        // Render notes for a card
        function renderClientNotes(cardId, clientId) {
            try {
                const notes = getClientNotes(clientId);
                const notesSection = document.getElementById(`notes-section-${cardId}`);

                if (!notesSection) return;

                if (notes.length === 0) {
                    notesSection.innerHTML = '';
                    return;
                }

                notesSection.innerHTML = `
                    <div class="notes-section-header">Notes</div>
                    <ul class="notes-list">
                        ${notes.map((note, index) => `
                            <li data-note-index="${index}">
                                <span class="note-text">${note}</span>
                                <span class="note-actions">
                                    <button class="note-edit-btn" data-client-id="${clientId}" data-card-id="${cardId}" data-note-index="${index}" title="Edit note">✏️</button>
                                    <button class="note-delete-btn" data-client-id="${clientId}" data-card-id="${cardId}" data-note-index="${index}" title="Delete note">🗑️</button>
                                </span>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } catch (e) {
                console.error('Error rendering notes:', e);
            }
        }

        // Edit a note
        function editClientNote(clientId, noteIndex, newText) {
            try {
                const allNotes = localStorage.getItem(NOTES_STORAGE_KEY);
                const notesObj = allNotes ? JSON.parse(allNotes) : {};

                if (!notesObj[clientId] || !notesObj[clientId][noteIndex]) {
                    return false;
                }

                notesObj[clientId][noteIndex] = newText;
                localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(notesObj));
                return true;
            } catch (e) {
                console.error('Error editing note:', e);
                return false;
            }
        }

        // Delete a note
        function deleteClientNote(clientId, noteIndex) {
            try {
                const allNotes = localStorage.getItem(NOTES_STORAGE_KEY);
                const notesObj = allNotes ? JSON.parse(allNotes) : {};

                if (!notesObj[clientId] || !notesObj[clientId][noteIndex]) {
                    return false;
                }

                notesObj[clientId].splice(noteIndex, 1);
                localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(notesObj));
                return true;
            } catch (e) {
                console.error('Error deleting note:', e);
                return false;
            }
        }

        // ============= CURRENT CAMPAIGN FUNCTIONS =============
        const CAMPAIGN_STORAGE_KEY = 'clientCampaigns';

        // Get campaigns for a client
        function getClientCampaigns(clientId) {
            try {
                const allCampaigns = localStorage.getItem(CAMPAIGN_STORAGE_KEY);
                const campaignsObj = allCampaigns ? JSON.parse(allCampaigns) : {};
                return campaignsObj[clientId] || [];
            } catch (e) {
                console.error('Error getting campaigns:', e);
                return [];
            }
        }

        // Save campaign for a client
        function saveClientCampaign(clientId, campaignText) {
            try {
                const allCampaigns = localStorage.getItem(CAMPAIGN_STORAGE_KEY);
                const campaignsObj = allCampaigns ? JSON.parse(allCampaigns) : {};

                if (!campaignsObj[clientId]) {
                    campaignsObj[clientId] = [];
                }

                campaignsObj[clientId].push(campaignText);
                localStorage.setItem(CAMPAIGN_STORAGE_KEY, JSON.stringify(campaignsObj));
                return true;
            } catch (e) {
                console.error('Error saving campaign:', e);
                return false;
            }
        }

        // Render campaigns for a card
        function renderClientCampaigns(cardId, clientId) {
            try {
                const campaigns = getClientCampaigns(clientId);
                const campaignList = document.getElementById(`campaign-list-${cardId}`);

                if (!campaignList) return;

                if (campaigns.length === 0) {
                    campaignList.innerHTML = '';
                    return;
                }

                campaignList.innerHTML = `
                    <ul class="campaign-list">
                        ${campaigns.map((campaign, index) => `
                            <li data-campaign-index="${index}">
                                <span class="campaign-text">${campaign}</span>
                                <span class="campaign-actions">
                                    <button class="campaign-edit-btn" data-client-id="${clientId}" data-card-id="${cardId}" data-campaign-index="${index}" title="Edit campaign">✏️</button>
                                    <button class="campaign-delete-btn" data-client-id="${clientId}" data-card-id="${cardId}" data-campaign-index="${index}" title="Delete campaign">🗑️</button>
                                </span>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } catch (e) {
                console.error('Error rendering campaigns:', e);
            }
        }

        // Edit a campaign
        function editClientCampaign(clientId, campaignIndex, newText) {
            try {
                const allCampaigns = localStorage.getItem(CAMPAIGN_STORAGE_KEY);
                const campaignsObj = allCampaigns ? JSON.parse(allCampaigns) : {};

                if (!campaignsObj[clientId] || !campaignsObj[clientId][campaignIndex]) {
                    return false;
                }

                campaignsObj[clientId][campaignIndex] = newText;
                localStorage.setItem(CAMPAIGN_STORAGE_KEY, JSON.stringify(campaignsObj));
                return true;
            } catch (e) {
                console.error('Error editing campaign:', e);
                return false;
            }
        }

        // Delete a campaign
        function deleteClientCampaign(clientId, campaignIndex) {
            try {
                const allCampaigns = localStorage.getItem(CAMPAIGN_STORAGE_KEY);
                const campaignsObj = allCampaigns ? JSON.parse(allCampaigns) : {};

                if (!campaignsObj[clientId] || !campaignsObj[clientId][campaignIndex]) {
                    return false;
                }

                campaignsObj[clientId].splice(campaignIndex, 1);
                localStorage.setItem(CAMPAIGN_STORAGE_KEY, JSON.stringify(campaignsObj));
                return true;
            } catch (e) {
                console.error('Error deleting campaign:', e);
                return false;
            }
        }

        // USPS state abbreviations mapping
        const STATE_ABBR_MAP = {
            'alabama': 'AL', 'alaska': 'AK', 'arizona': 'AZ', 'arkansas': 'AR', 'california': 'CA',
            'colorado': 'CO', 'connecticut': 'CT', 'delaware': 'DE', 'florida': 'FL', 'georgia': 'GA',
            'hawaii': 'HI', 'idaho': 'ID', 'illinois': 'IL', 'indiana': 'IN', 'iowa': 'IA',
            'kansas': 'KS', 'kentucky': 'KY', 'louisiana': 'LA', 'maine': 'ME', 'maryland': 'MD',
            'massachusetts': 'MA', 'michigan': 'MI', 'minnesota': 'MN', 'mississippi': 'MS', 'missouri': 'MO',
            'montana': 'MT', 'nebraska': 'NE', 'nevada': 'NV', 'new hampshire': 'NH', 'new jersey': 'NJ',
            'new mexico': 'NM', 'new york': 'NY', 'north carolina': 'NC', 'north dakota': 'ND', 'ohio': 'OH',
            'oklahoma': 'OK', 'oregon': 'OR', 'pennsylvania': 'PA', 'rhode island': 'RI', 'south carolina': 'SC',
            'south dakota': 'SD', 'tennessee': 'TN', 'texas': 'TX', 'utah': 'UT', 'vermont': 'VT',
            'virginia': 'VA', 'washington': 'WA', 'west virginia': 'WV', 'wisconsin': 'WI', 'wyoming': 'WY'
        };

        // Normalization functions
        function isAcronym(word) {
            // Preserve words ≥3 letters that are all caps
            return word.length >= 3 && word === word.toUpperCase() && /^[A-Z]+$/.test(word);
        }

        function smartTitleCase(str) {
            return str.replace(/\b\w+\b/g, word => {
                // Preserve acronyms and suffixes
                if (isAcronym(word)) return word;
                // Preserve common suffixes
                if (['LLC', 'LLP', 'INC', 'CORP', 'LTD', 'PC', 'LP', 'DBA'].includes(word.toUpperCase())) {
                    return word.toUpperCase();
                }
                // Title case for regular words
                return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
            });
        }

        function normalizeAddress(addr) {
            if (!addr) return '';
            // Keep USPS abbreviations, don't modify ZIP codes
            // Just trim extra spaces and normalize comma spacing
            return addr.replace(/\s*,\s*/g, ', ')
                      .replace(/\s{2,}/g, ' ')
                      .trim();
        }

        function normalizeStateName(state) {
            const normalized = state.trim().toLowerCase();
            return STATE_ABBR_MAP[normalized] || state.trim().toUpperCase();
        }

        function normalizeLicensedStates(states) {
            if (!states || !Array.isArray(states)) return '';
            return states.map(normalizeStateName).join(', ');
        }

        function normalizeTargets(targetArray) {
            if (!targetArray || !Array.isArray(targetArray)) return [];
            return targetArray.map(target => {
                // Preserve acronyms, apply smart sentence case
                return target.split(/\b/).map(part => {
                    const word = part.trim();
                    if (!word) return part;
                    if (isAcronym(word)) return word;
                    if (/^[A-Za-z]+$/.test(word)) {
                        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                    }
                    return part;
                }).join('');
            });
        }

        // Helper to get initials from name
        function getInitials(name) {
            if (!name) return '?';
            const parts = name.trim().split(' ');
            if (parts.length === 1) return parts[0].substring(0, 2).toUpperCase();
            return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
        }

        // Popover toggle for team members
        function wireTeamPopover(btnId, popId) {
            const btn = document.getElementById(btnId);
            const pop = document.getElementById(popId);
            if (!btn || !pop) return;

            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const willOpen = pop.hasAttribute('hidden');
                document.querySelectorAll('.popover').forEach(p => p.setAttribute('hidden', ''));
                pop.toggleAttribute('hidden', !willOpen);
                btn.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
            });

            document.addEventListener('click', (e) => {
                if (!pop.contains(e.target) && !btn.contains(e.target)) {
                    pop.setAttribute('hidden', '');
                    btn.setAttribute('aria-expanded', 'false');
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    pop.setAttribute('hidden', '');
                    btn.setAttribute('aria-expanded', 'false');
                    btn.focus();
                }
            });
        }

        function renderClients(clientsToRender = clients) {
            const grid = document.getElementById('clientsGrid');

            if (clientsToRender.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: white; border-radius: 15px;">
                        <h3>No clients found</h3>
                        <p>Try adjusting your search.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = clientsToRender.map((client, index) => {
                const cardId = `card-${index}`;
                const teamBtnId = `teamBtn-${index}`;
                const teamPopId = `teamPop-${index}`;

                // Normalize data
                const businessName = smartTitleCase(client.businessName);
                const address = normalizeAddress(client.address);
                const licensedStates = client.licensedStates ? normalizeLicensedStates(client.licensedStates) : '';
                const targets = normalizeTargets(client.targetIndustries);

                // Determine setter attribute
                const setterAttr = client.setter.toLowerCase().includes('brendan') ? 'brendan' : 'jacques';

                // Generate client ID for notes
                const clientId = client.businessName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');

                return `
                    <div class="client-card" id="${cardId}" data-setter="${setterAttr}" data-client-id="${clientId}">
                        <header class="card-head">
                            <div class="card-head-left">
                                <h2 class="business-name">${businessName}</h2>
                                ${address ? `<div class="info-line address">${address}</div>` : ''}
                                <div class="timezone-info">Timezone: ${client.timezone || '<span style="color: var(--text-tertiary);">—</span>'}</div>
                                ${client.setter ? `<div class="setter-info">Setter: ${client.setter}</div>` : ''}
                            </div>
                            <div class="card-head-right">
                                <div class="owner-block">
                                    ${client.ownerName ? `<div class="owner-name">${client.ownerName}</div>` : ''}
                                    ${client.ownerPhone ? `<div>${client.ownerPhone}</div>` : ''}
                                    ${client.ownerEmail ? `<div>${client.ownerEmail}</div>` : ''}
                                </div>
                                ${client.brokers.length > 0 ? `
                                    <div class="team-control">
                                        <button class="btn btn-ghost" id="${teamBtnId}" type="button" aria-haspopup="true" aria-expanded="false">
                                            <span class="chev">▾</span>
                                            <span>Team</span>
                                            <span class="badge">${client.brokers.length}</span>
                                        </button>
                                        <div class="popover" id="${teamPopId}" hidden>
                                            ${client.brokers.map(broker => `
                                                <div class="popover-item">
                                                    <div class="avatar">${getInitials(broker.name)}</div>
                                                    <div>
                                                        <div class="team-member-name">${broker.name}</div>
                                                        ${broker.phone ? `<div class="team-member-contact">${broker.phone}</div>` : ''}
                                                        ${broker.email ? `<div class="team-member-contact">${broker.email}</div>` : ''}
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                <button class="btn-add-notes" data-client-id="${clientId}" data-card-id="${cardId}" type="button">
                                    <span>📝</span>
                                    <span>Add Notes</span>
                                </button>
                            </div>
                        </header>

                        <div class="client-info">
                            <!-- Unified Button Row -->
                            <div class="info-buttons-row">
                                <button class="info-button notes-btn" data-toggle-info="notes-content-${cardId}">Notes</button>
                                <button class="info-button campaign-btn" data-toggle-info="campaign-content-${cardId}">Campaign</button>
                                ${targets.length > 0 ? `<button class="info-button industries-btn" data-toggle-info="industries-content-${cardId}">Industries</button>` : ''}
                            </div>

                            <!-- Notes Content (Hidden by default) -->
                            <div class="info-content" id="notes-content-${cardId}" style="display: none;">
                                <div class="client-notes-section" id="notes-section-${cardId}">
                                    <!-- Notes will be rendered here -->
                                </div>
                            </div>

                            <!-- Campaign Content (Hidden by default) -->
                            <div class="info-content" id="campaign-content-${cardId}" style="display: none;">
                                <div class="current-campaign-section">
                                    <div class="campaign-header">
                                        <div class="section-label collapsible-label collapsed" data-toggle="campaign-list-${cardId}">
                                            <span>Current Campaign<span class="collapsible-hint">Click to see</span></span>
                                        </div>
                                        <button class="btn-add-campaign" data-client-id="${clientId}" data-card-id="${cardId}" type="button">
                                            <span>+</span>
                                            <span>Add</span>
                                        </button>
                                    </div>
                                    <div id="campaign-list-${cardId}" class="collapsible-content collapsed">
                                        <!-- Campaign items will be rendered here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Industries Content (Hidden by default) -->
                            ${targets.length > 0 ? `
                                <div class="info-content" id="industries-content-${cardId}" style="display: none;">
                                    <div class="targets-section">
                                        <div class="section-label collapsible-label collapsed" data-toggle="industries-${cardId}">
                                            <span>Industries<span class="collapsible-hint">Click to see</span></span>
                                        </div>
                                        <ul class="targets collapsible-content collapsed" id="industries-${cardId}">
                                            ${targets.map(t => `<li>${t.charAt(0).toUpperCase() + t.slice(1)}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            ` : ''}

                            ${licensedStates ? `
                                <div class="licensed-section">
                                    <div class="zone-header-chip"><span>Target States</span></div>
                                    <p class="licensed">${licensedStates}</p>
                                </div>
                            ` : ''}
                        </div>

                        <div class="card-footer">
                            <div class="airtable-stats" id="stats-${cardId}">
                                <!-- Stats will be rendered here -->
                            </div>
                            ${client.ghlLocationId ? `
                            <div class="metrics-badge" id="metrics-${cardId}" data-location-id="${client.ghlLocationId}">
                                🔄 Loading metrics...
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Wire up all team popovers and render notes and stats
            clientsToRender.forEach((client, index) => {
                const cardId = `card-${index}`;
                const clientId = client.businessName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');

                if (client.brokers.length > 0) {
                    wireTeamPopover(`teamBtn-${index}`, `teamPop-${index}`);
                }

                // Render notes for this client
                renderClientNotes(cardId, clientId);

                // Render campaigns for this client
                renderClientCampaigns(cardId, clientId);

                // Render Airtable stats for this client
                renderStats(cardId, client.businessName);

                // Render GHL Today's Metrics for this client
                renderTodayMetrics(cardId, client);
            });

            // Update dashboard totals after initial render (with small delay for metrics to load)
            setTimeout(() => updateDashboardTotals(), 1000);
        }

        // Filter and sorting functionality
        let activeFilter = 'all';
        let isPrioritySortActive = false;

        // Calculate priority score (lower is more urgent)
        function calculatePriority(businessName) {
            const stats = getStatsForBusiness(businessName);

            // Parse booked/goal (e.g., "5/10" or "—/—")
            if (stats.booked === '—/—') {
                return 999; // No data = lowest priority
            }

            const parts = stats.booked.split('/');
            const booked = parseInt(parts[0]) || 0;
            const goal = parseInt(parts[1]) || 1;

            // Calculate percentage behind (lower = more behind = higher priority)
            const percentageComplete = (booked / goal) * 100;

            // Parse days left
            let daysMultiplier = 1;
            if (stats.daysLeft !== '—') {
                if (stats.daysLeft.includes('over')) {
                    daysMultiplier = 0.5; // Very urgent if over deadline
                } else {
                    const daysMatch = stats.daysLeft.match(/(\d+)d/);
                    if (daysMatch) {
                        const days = parseInt(daysMatch[1]);
                        if (days <= 7) daysMultiplier = 0.7; // More urgent if less time
                    }
                }
            }

            // Lower score = higher priority
            return percentageComplete * daysMultiplier;
        }

        function sortClientsByPriority() {
            if (!isPrioritySortActive) {
                // Sort by priority (most behind first)
                clients.sort((a, b) => {
                    const priorityA = calculatePriority(a.businessName);
                    const priorityB = calculatePriority(b.businessName);
                    return priorityA - priorityB;
                });
                isPrioritySortActive = true;
                document.getElementById('sortPriorityBtn').classList.add('active');
            } else {
                // Return to default sort (by setter, then business name)
                clients.sort((a, b) => {
                    if (a.setter !== b.setter) {
                        return a.setter.localeCompare(b.setter);
                    }
                    return a.businessName.localeCompare(b.businessName);
                });
                isPrioritySortActive = false;
                document.getElementById('sortPriorityBtn').classList.remove('active');
            }

            // Re-render with new sort order
            renderClients();
            applyFilter(activeFilter);
        }

        function applyFilter(filter) {
            activeFilter = filter;
            const cards = document.querySelectorAll('.client-card');

            cards.forEach(card => {
                const setter = card.getAttribute('data-setter');
                if (filter === 'all') {
                    card.style.display = '';
                } else {
                    card.style.display = setter === filter ? '' : 'none';
                }
            });

            updatePillCounts();
            updateActivePill(filter);
            updateDashboardTotals();
        }

        function updatePillCounts() {
            const cards = document.querySelectorAll('.client-card');
            let brendanCount = 0;
            let jacquesCount = 0;

            cards.forEach(card => {
                if (card.style.display !== 'none') {
                    const setter = card.getAttribute('data-setter');
                    if (setter === 'brendan') brendanCount++;
                    if (setter === 'jacques') jacquesCount++;
                }
            });

            document.getElementById('count-brendan').textContent = brendanCount;
            document.getElementById('count-jacques').textContent = jacquesCount;
        }

        function updateActivePill(filter) {
            document.querySelectorAll('.pill').forEach(p => {
                p.classList.remove('active');
                p.setAttribute('aria-selected', 'false');
            });
            const activePill = document.getElementById(`pill-${filter}`);
            activePill.classList.add('active');
            activePill.setAttribute('aria-selected', 'true');
        }

        // Pill event listeners
        document.getElementById('pill-all').addEventListener('click', () => applyFilter('all'));
        document.getElementById('pill-brendan').addEventListener('click', () => applyFilter('brendan'));
        document.getElementById('pill-jacques').addEventListener('click', () => applyFilter('jacques'));

        // Refresh button event listener
        document.getElementById('refreshStatsBtn').addEventListener('click', () => {
            refreshStats(true); // Manual refresh with visual feedback
        });

        // Priority sort button event listener
        document.getElementById('sortPriorityBtn').addEventListener('click', () => {
            sortClientsByPriority();
        });

        // Keyboard navigation for pills
        const pills = document.querySelectorAll('.pill');
        const pillsContainer = document.querySelector('.pills');

        pillsContainer.addEventListener('keydown', (e) => {
            const currentPill = document.activeElement;
            if (!currentPill.classList.contains('pill')) return;

            const pillArray = Array.from(pills);
            const currentIndex = pillArray.indexOf(currentPill);

            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                e.preventDefault();
                let nextIndex;
                if (e.key === 'ArrowRight') {
                    nextIndex = (currentIndex + 1) % pillArray.length;
                } else {
                    nextIndex = (currentIndex - 1 + pillArray.length) % pillArray.length;
                }
                pillArray[nextIndex].focus();
                pillArray[nextIndex].click();
            }
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();

            if (!searchTerm) {
                renderClients(clients);
                applyFilter(activeFilter); // Reapply current filter
                return;
            }

            const filtered = clients.filter(client => {
                // Existing search fields
                if (client.businessName.toLowerCase().includes(searchTerm) ||
                    client.ownerName.toLowerCase().includes(searchTerm) ||
                    client.setter.toLowerCase().includes(searchTerm) ||
                    (client.ownerEmail && client.ownerEmail.toLowerCase().includes(searchTerm)) ||
                    (client.ownerPhone && client.ownerPhone.includes(searchTerm))) {
                    return true;
                }

                // State search: check if search term matches any licensed state
                if (client.licensedStates && Array.isArray(client.licensedStates)) {
                    // Convert search term to state abbreviation if it's a full state name
                    const stateAbbr = STATE_ABBR_MAP[searchTerm] || searchTerm.toUpperCase();

                    // Check if any licensed state matches
                    return client.licensedStates.some(state =>
                        state.toUpperCase() === stateAbbr
                    );
                }

                return false;
            });

            renderClients(filtered);
            applyFilter(activeFilter); // Reapply current filter to search results
        });

        // ============= NOTES EVENT HANDLERS =============
        // Handle Add Notes button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.btn-add-notes');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');

            // Check if input already exists
            if (btn.nextElementSibling && btn.nextElementSibling.classList.contains('notes-input-container')) {
                return; // Input already showing
            }

            // Create input container
            const inputContainer = document.createElement('div');
            inputContainer.className = 'notes-input-container';
            inputContainer.innerHTML = `
                <input type="text" class="notes-input" placeholder="Add a note... (press Enter)" data-client-id="${clientId}" data-card-id="${cardId}">
            `;

            btn.parentNode.insertBefore(inputContainer, btn.nextSibling);
            inputContainer.querySelector('.notes-input').focus();
        });

        // Handle Enter key on notes input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Enter') return;

            const input = e.target;
            if (!input.classList.contains('notes-input')) return;

            const noteText = input.value.trim();
            if (!noteText) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');

            // Save the note
            if (saveClientNote(clientId, noteText)) {
                // Clear input
                input.value = '';

                // Re-render notes
                renderClientNotes(cardId, clientId);
            }
        });

        // Handle Escape key to close input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Escape') return;

            const input = e.target;
            if (!input.classList.contains('notes-input')) return;

            const container = input.closest('.notes-input-container');
            if (container) {
                container.remove();
            }
        });

        // Handle edit button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.note-edit-btn');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');
            const noteIndex = parseInt(btn.getAttribute('data-note-index'));

            const li = btn.closest('li');
            const noteTextEl = li.querySelector('.note-text');
            const currentText = noteTextEl.textContent;

            // Replace note text with input
            noteTextEl.innerHTML = `<input type="text" class="note-edit-input" value="${currentText}" data-client-id="${clientId}" data-card-id="${cardId}" data-note-index="${noteIndex}">`;
            const editInput = noteTextEl.querySelector('.note-edit-input');
            editInput.focus();
            editInput.select();
        });

        // Handle Enter key on edit input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Enter') return;

            const input = e.target;
            if (!input.classList.contains('note-edit-input')) return;

            const newText = input.value.trim();
            if (!newText) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');
            const noteIndex = parseInt(input.getAttribute('data-note-index'));

            // Save edited note
            if (editClientNote(clientId, noteIndex, newText)) {
                // Re-render notes
                renderClientNotes(cardId, clientId);
            }
        });

        // Handle Escape key on edit input (cancel edit)
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Escape') return;

            const input = e.target;
            if (!input.classList.contains('note-edit-input')) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');

            // Re-render to cancel edit
            renderClientNotes(cardId, clientId);
        });

        // Handle delete button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.note-delete-btn');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');
            const noteIndex = parseInt(btn.getAttribute('data-note-index'));

            // Delete note
            if (deleteClientNote(clientId, noteIndex)) {
                // Re-render notes
                renderClientNotes(cardId, clientId);
            }
        });

        // ============= CURRENT CAMPAIGN EVENT HANDLERS =============
        // Handle Add Campaign button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.btn-add-campaign');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');

            // Check if input already exists
            if (btn.nextElementSibling && btn.nextElementSibling.classList.contains('campaign-input-container')) {
                return; // Input already showing
            }

            // Create input container
            const inputContainer = document.createElement('div');
            inputContainer.className = 'campaign-input-container';
            inputContainer.innerHTML = `
                <input type="text" class="campaign-input" placeholder="Add campaign... (press Enter)" data-client-id="${clientId}" data-card-id="${cardId}">
            `;

            btn.parentNode.insertBefore(inputContainer, btn.nextSibling);
            inputContainer.querySelector('.campaign-input').focus();
        });

        // Handle Enter key on campaign input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Enter') return;

            const input = e.target;
            if (!input.classList.contains('campaign-input')) return;

            const campaignText = input.value.trim();
            if (!campaignText) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');

            // Save the campaign
            if (saveClientCampaign(clientId, campaignText)) {
                // Clear input
                input.value = '';

                // Re-render campaigns
                renderClientCampaigns(cardId, clientId);
            }
        });

        // Handle Escape key to close campaign input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Escape') return;

            const input = e.target;
            if (!input.classList.contains('campaign-input')) return;

            const container = input.closest('.campaign-input-container');
            if (container) {
                container.remove();
            }
        });

        // Handle campaign edit button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.campaign-edit-btn');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');
            const campaignIndex = parseInt(btn.getAttribute('data-campaign-index'));

            const li = btn.closest('li');
            const campaignTextEl = li.querySelector('.campaign-text');
            const currentText = campaignTextEl.textContent;

            // Replace campaign text with input
            campaignTextEl.innerHTML = `<input type="text" class="campaign-edit-input" value="${currentText}" data-client-id="${clientId}" data-card-id="${cardId}" data-campaign-index="${campaignIndex}">`;
            const editInput = campaignTextEl.querySelector('.campaign-edit-input');
            editInput.focus();
            editInput.select();
        });

        // Handle Enter key on campaign edit input
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Enter') return;

            const input = e.target;
            if (!input.classList.contains('campaign-edit-input')) return;

            const newText = input.value.trim();
            if (!newText) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');
            const campaignIndex = parseInt(input.getAttribute('data-campaign-index'));

            // Save edited campaign
            if (editClientCampaign(clientId, campaignIndex, newText)) {
                // Re-render campaigns
                renderClientCampaigns(cardId, clientId);
            }
        });

        // Handle Escape key on campaign edit input (cancel edit)
        document.addEventListener('keydown', (e) => {
            if (e.key !== 'Escape') return;

            const input = e.target;
            if (!input.classList.contains('campaign-edit-input')) return;

            const clientId = input.getAttribute('data-client-id');
            const cardId = input.getAttribute('data-card-id');

            // Re-render to cancel edit
            renderClientCampaigns(cardId, clientId);
        });

        // Handle campaign delete button clicks
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.campaign-delete-btn');
            if (!btn) return;

            const clientId = btn.getAttribute('data-client-id');
            const cardId = btn.getAttribute('data-card-id');
            const campaignIndex = parseInt(btn.getAttribute('data-campaign-index'));

            // Delete campaign
            if (deleteClientCampaign(clientId, campaignIndex)) {
                // Re-render campaigns
                renderClientCampaigns(cardId, clientId);
            }
        });

        // ============= COLLAPSIBLE SECTIONS =============
        // Handle collapsible Industries and Target States sections
        document.addEventListener('click', (e) => {
            const label = e.target.closest('.collapsible-label');
            if (!label) return;

            const targetId = label.getAttribute('data-toggle');
            const content = document.getElementById(targetId);

            if (!content) return;

            // Toggle collapsed class
            label.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        });

        // Handle zone-header-chip clicks for Campaign and Industries
        document.addEventListener('click', (e) => {
            const chip = e.target.closest('[data-toggle-section]');
            if (!chip) return;

            const sectionId = chip.getAttribute('data-toggle-section');
            const section = document.getElementById(sectionId);

            if (!section) return;

            // Toggle chip-collapsed class on the section
            section.classList.toggle('chip-collapsed');

            // Show/hide the content inside
            const header = section.querySelector('.campaign-header, .section-label');
            const content = section.querySelector('.collapsible-content, .targets');

            if (header) {
                header.style.display = section.classList.contains('chip-collapsed') ? 'none' : 'flex';
            }
            if (content) {
                content.style.display = section.classList.contains('chip-collapsed') ? 'none' : 'block';
            }
        });

        // Handle info button clicks (Notes/Campaign/Industries)
        document.addEventListener('click', (e) => {
            const button = e.target.closest('[data-toggle-info]');
            if (!button) return;

            const contentId = button.getAttribute('data-toggle-info');
            const content = document.getElementById(contentId);

            if (!content) return;

            // Get all info buttons and content in the same card
            const card = button.closest('.client-card');
            const allButtons = card.querySelectorAll('.info-button');
            const allContent = card.querySelectorAll('.info-content');

            // If clicking the active button, close it
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                content.style.display = 'none';
            } else {
                // Close all other sections
                allButtons.forEach(btn => btn.classList.remove('active'));
                allContent.forEach(c => c.style.display = 'none');

                // Open this section
                button.classList.add('active');
                content.style.display = 'block';
            }
        });

        // Auto-refresh timer management
        function startAutoRefresh() {
            if (!AIRTABLE_CONFIG.enableAutoRefresh || !AIRTABLE_CONFIG.enabled) return;

            // Clear any existing timer
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }

            // Set up periodic refresh
            autoRefreshTimer = setInterval(() => {
                refreshStats(false); // Auto-refresh without visual feedback
            }, AIRTABLE_CONFIG.autoRefreshInterval);
        }

        function stopAutoRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
                autoRefreshTimer = null;
            }
        }

        // Page Visibility API - pause auto-refresh when page is hidden
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
                // Also update the "last updated" display when page becomes visible
                updateLastUpdatedDisplay();
            }
        });

        // ============= PAGE NAVIGATION =============
        let currentPage = 'clients';

        function switchPage(pageName) {
            // Update sidebar active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageName) {
                    item.classList.add('active');
                }
            });

            // Update current page
            currentPage = pageName;

            // Show/hide appropriate page
            const clientsPage = document.getElementById('page-clients');
            const otherPage = document.getElementById('page-other');

            if (pageName === 'clients') {
                clientsPage.style.display = 'block';
                otherPage.style.display = 'none';
            } else {
                clientsPage.style.display = 'none';
                otherPage.style.display = 'block';
                showComingSoonPage(pageName);
            }
        }

        function showComingSoonPage(pageName) {
            const otherPage = document.getElementById('page-other');
            const pageTitle = pageName.charAt(0).toUpperCase() + pageName.slice(1);

            otherPage.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; padding: 40px;">
                    <div style="font-size: 64px; margin-bottom: 24px;">🚀</div>
                    <h2 style="font-size: 32px; margin-bottom: 16px; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${pageTitle} Page</h2>
                    <p style="color: var(--text-secondary); font-size: 18px; max-width: 500px; margin-bottom: 32px;">
                        This feature is coming soon! We're building an amazing ${pageName} experience for you.
                    </p>
                    <button class="btn btn-primary" onclick="switchPage('clients')">
                        <span>← Back to Clients</span>
                    </button>
                </div>
            `;
        }

        // Wire up sidebar navigation
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.getAttribute('data-page');
                    if (page) {
                        switchPage(page);
                    }
                });
            });
        });

        // Initial render with Airtable data
        async function initializeApp() {
            APP_METRICS.mark('init-start');

            // Fetch Airtable stats first
            await fetchAirtableStats();

            // Then render clients with stats
            APP_METRICS.mark('render-start');
            renderClients();
            applyFilter('all');
            APP_METRICS.mark('render-end');
            APP_METRICS.measure('initial-render', 'render-start', 'render-end');

            // Start auto-refresh timer
            startAutoRefresh();

            // Start GHL auto-refresh timer
            startGHLAutoRefresh();

            // Initialize the timestamp display
            updateLastUpdatedDisplay();

            // Update timestamp display every minute
            setInterval(updateLastUpdatedDisplay, 60000);

            APP_METRICS.mark('init-end');
            APP_METRICS.measure('app-initialization', 'init-start', 'init-end');
            APP_METRICS.measure('total-startup', 'app-start', 'init-end');

            console.log('[Cycle 1] Foundation ready:', APP_METRICS.getSummary());
        }

        // Expose batch discovery function to window for console access
        window.discoverBookedStages = batchDiscoverBookedStages;

        // Start the app
        initializeApp();
    </script>

</body>
</html>
